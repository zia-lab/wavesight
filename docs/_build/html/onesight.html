<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>#OneSight &mdash; wavesight  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            wavesight
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="docs/wavesight.html">wavesight.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/fields.html">fields.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/maxwell.html">Maxwell’s Equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/diffkernels.html">diffkernels.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/misc.html">misc.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/fieldgenesis.html">fieldgenesis.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/fungenerators.html">fungenerators.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/convstore.html">convstore.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="farfield.html"># Farfield Propagators</a></li>
<li class="toctree-l1"><a class="reference internal" href="multifiber.html"># Multifiber</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">wavesight</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">#OneSight</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/onesight.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="#OneSight">
<h1>#OneSight<a class="headerlink" href="##OneSight" title="Link to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">codebase_dir</span> <span class="o">=</span> <span class="s1">&#39;/Users/juan/ZiaLab/Codebase&#39;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">codebase_dir</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">wavesight</span> <span class="k">as</span> <span class="nn">ws</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">special</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span><span class="p">,</span> <span class="n">root_scalar</span>
<span class="kn">import</span> <span class="nn">cmasher</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.axes_divider</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format=&#39;retina&#39;
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning disabling RuntimeWarning often due to evalution of square roots with negative arguments.</span><span class="se">\n</span><span class="s2">Probably produced by scalar_root.&quot;</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>
<span class="kn">import</span> <span class="nn">cmasher</span> <span class="k">as</span> <span class="nn">cmr</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Circle</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">RegularGridInterpolator</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Warning disabling RuntimeWarning often due to evalution of square roots with negative arguments.
Probably produced by scalar_root.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dev_design</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coreRadius&#39;</span><span class="p">:</span><span class="mf">25.</span><span class="p">,</span> <span class="s1">&#39;mlRadius&#39;</span><span class="p">:</span><span class="mf">50.</span><span class="p">,</span> <span class="s1">&#39;Δ&#39;</span><span class="p">:</span><span class="mf">15.</span><span class="p">,</span> <span class="s1">&#39;mlPitch&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span><span class="s1">&#39;NA&#39;</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span>
              <span class="s1">&#39;emDepth&#39;</span><span class="p">:</span><span class="mf">50.</span><span class="p">,</span> <span class="s1">&#39;emΔxy&#39;</span><span class="p">:</span><span class="mf">5.</span><span class="p">,</span> <span class="s1">&#39;emΔz&#39;</span><span class="p">:</span><span class="mf">10.</span><span class="p">,</span> <span class="s1">&#39;mlHeight&#39;</span><span class="p">:</span><span class="mf">0.7</span><span class="p">,</span>
              <span class="s1">&#39;nCore&#39;</span><span class="p">:</span><span class="mf">1.45</span><span class="p">,</span> <span class="s1">&#39;nHost&#39;</span><span class="p">:</span><span class="mf">2.41</span><span class="p">,</span> <span class="s1">&#39;nCore&#39;</span><span class="p">:</span><span class="mf">1.45</span><span class="p">,</span> <span class="s1">&#39;λFree&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">}</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">device_layout</span><span class="p">(</span><span class="n">dev_design</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/onesight_2_0.png" class="no-scaled-link" src="_images/onesight_2_0.png" style="width: 397px; height: 432px;" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fiber_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;NA&#39;</span><span class="p">:</span> <span class="mf">0.22</span><span class="p">,</span>
              <span class="s1">&#39;nCore&#39;</span><span class="p">:</span> <span class="mf">1.45</span><span class="p">,</span>
              <span class="s1">&#39;coreRadius&#39;</span><span class="p">:</span><span class="mf">25.</span><span class="p">,</span>
              <span class="s1">&#39;grid_divider&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s1">&#39;nFree&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span>
              <span class="s1">&#39;λFree&#39;</span><span class="p">:</span> <span class="mf">0.600</span><span class="p">}</span>
<span class="n">fiber_sol</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">multisolver</span><span class="p">(</span><span class="n">fiber_spec</span><span class="p">,</span> <span class="n">solve_modes</span> <span class="o">=</span> <span class="s1">&#39;transverse&#39;</span><span class="p">,</span> <span class="n">drawPlots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimating nCladding from nCore and NA ...
========================================
Approx number of complex HE modes:  800
Approx number of TE modes:  28
Approx number of TM modes:  28
Approx number of total modes:  1658
Approx Max n for HE modes:  40
========================================
Calculating TE(0,n) propagation constants ...
Calculating TM(0,n) propagation constants ...

========================================
HE modes = 0
TE modes = 36
TM modes = 36
TOTAL modes = 72
FROM_Vnum = 1658
========================================
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># kz = fiber_sol[&#39;TEkz&#39;][0][0]</span>
<span class="c1"># stuff = r&#39;&#39;&#39;\begin{align*}</span>
<span class="c1"># \nabla^2 \vec{H} + \frac{n^2 \omega^2}{c^2} \vec{H} &amp;= i \omega \epsilon_0 \left(\nabla n^2\right)\!\!\times\!\!\vec{E} \\</span>
<span class="c1"># \nabla^2 \vec{E} + \frac{n^2 \omega^2}{c^2} \vec{E} &amp;=  \nabla \left(\frac{1}{n^2}\left(\nabla n^2\right) \cdot \vec{E}\right) \\</span>
<span class="c1"># n^2 &amp;= \frac{\epsilon}{\epsilon_0} \\</span>
<span class="c1"># \vec{E}_t &amp;= \frac{i}{\zeta^2} \left( k_z \nabla_t E_z - \omega \mu_0 \hat{z} \times \nabla_t H_z \right) \\</span>
<span class="c1"># \vec{H}_t &amp;= \frac{i}{\zeta^2} \left( k_z \nabla_t H_z + \omega \epsilon_0 n^2 \hat{z} \times \nabla_t E_z \right) \\</span>
<span class="c1"># \zeta^2 &amp;= \frac{n^2\omega^2}{c^2} - k_z^2 \\</span>
<span class="c1"># E_z &amp;= A_e J_m(\gamma \rho) e^{i m \phi} \text{ for } \rho &lt; R_\text{core} \\</span>
<span class="c1"># E_z &amp;= B_e K_m(\beta \rho) e^{i m \phi} \text{ for } \rho &gt; R_\text{core} \\</span>
<span class="c1"># H_z &amp;= A_h J_m(\gamma \rho) e^{i m \phi} \text{ for } \rho &lt; R_\text{core} \\</span>
<span class="c1"># H_z &amp;= B_h K_m(\beta \rho) e^{i m \phi} \text{ for } \rho &gt; R_\text{core} \\</span>
<span class="c1"># \gamma^2 &amp;= \frac{n_\text{core}^2 \omega^2}{c^2} - k_z^2 \\</span>
<span class="c1"># \beta^2 &amp;= k_z^2 - \frac{n_\text{cladd}^2 \omega^2}{c^2} \\</span>
<span class="c1"># A_e &amp;= %s \\</span>
<span class="c1"># A_h &amp;= %s \\</span>
<span class="c1"># B_e &amp;= %s \\</span>
<span class="c1"># B_h &amp;= %s \\</span>
<span class="c1"># \end{align*}&#39;&#39;&#39; % (ws.num2tex(1,2), ws.num2tex(1,2), ws.num2tex(1,2), ws.num2tex(1,2))</span>
<span class="c1"># ws.latex_eqn_to_png(stuff,&#39;trial&#39;)</span>
<br/></pre></div>
</div>
</div>
<section id="##FG050LGA">
<h2>##FG050LGA<a class="headerlink" href="###FG050LGA" title="Link to this heading">¶</a></h2>
<section id="###Calculate-the-numerical-mode-basis">
<h3>###Calculate the numerical mode basis<a class="headerlink" href="####Calculate-the-numerical-mode-basis" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fiber_sol</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">calculate_numerical_basis</span><span class="p">(</span><span class="n">fiber_sol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3783485275ad4abd9c632a442929b4f3", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d8129102777842f3a10d2c0ef4b4d785", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># grab the data for the mode of interest</span>
<span class="p">(</span><span class="n">modtype</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">kzidx</span><span class="p">,</span> <span class="n">γ</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span><span class="p">)</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;eigenbasis_nums&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">kz</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;TEkz&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># put everything together</span>
<span class="n">mode_info</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;\begin{align*}</span>
<span class="s1">\nabla^2 \vec</span><span class="si">{H}</span><span class="s1"> + \frac{n^2 \omega^2}{c^2} \vec</span><span class="si">{H}</span><span class="s1"> &amp;= i \omega \epsilon_0 \left(\nabla n^2\right)\!\!\times\!\!\vec</span><span class="si">{E}</span><span class="s1"> \\</span>
<span class="s1">\nabla^2 \vec</span><span class="si">{E}</span><span class="s1"> + \frac{n^2 \omega^2}{c^2} \vec</span><span class="si">{E}</span><span class="s1"> &amp;=  \nabla \left(\frac</span><span class="si">{1}</span><span class="s1">{n^2}\left(\nabla n^2\right) \cdot \vec</span><span class="si">{E}</span><span class="s1">\right) \\</span>
<span class="s1">n^2 &amp;= \frac{\epsilon}{\epsilon_0} \\</span>
<span class="s1">\vec</span><span class="si">{E}</span><span class="s1">_t &amp;= \frac</span><span class="si">{i}</span><span class="s1">{\zeta^2} \left( k_z \nabla_t E_z - \omega \mu_0 \hat</span><span class="si">{z}</span><span class="s1"> \times \nabla_t H_z \right) \\</span>
<span class="s1">\vec</span><span class="si">{H}</span><span class="s1">_t &amp;= \frac</span><span class="si">{i}</span><span class="s1">{\zeta^2} \left( k_z \nabla_t H_z + \omega \epsilon_0 n^2 \hat</span><span class="si">{z}</span><span class="s1"> \times \nabla_t E_z \right) \\</span>
<span class="s1">\zeta^2 &amp;= \frac{n^2\omega^2}{c^2} - k_z^2 \\</span>
<span class="s1">E_z &amp;= A_e J_m(\gamma \rho) e^{i m \phi} \text{ for } \rho &lt; R_\text</span><span class="si">{core}</span><span class="s1"> \\</span>
<span class="s1">E_z &amp;= B_e K_m(\beta \rho) e^{i m \phi} \text{ for } \rho &gt; R_\text</span><span class="si">{core}</span><span class="s1"> \\</span>
<span class="s1">H_z &amp;= A_h J_m(\gamma \rho) e^{i m \phi} \text{ for } \rho &lt; R_\text</span><span class="si">{core}</span><span class="s1"> \\</span>
<span class="s1">H_z &amp;= B_h K_m(\beta \rho) e^{i m \phi} \text{ for } \rho &gt; R_\text</span><span class="si">{core}</span><span class="s1"> \\</span>
<span class="s1">\gamma^2 &amp;= \frac{n_\text</span><span class="si">{core}</span><span class="s1">^2 \omega^2}{c^2} - k_z^2 \\</span>
<span class="s1">\beta^2 &amp;= k_z^2 - \frac{n_\text</span><span class="si">{cladd}</span><span class="s1">^2 \omega^2}{c^2} \\</span>
<span class="s1">R_\text</span><span class="si">{core}</span><span class="s1"> &amp;= </span><span class="si">%s</span><span class="s1"> \mu\text</span><span class="si">{m}</span><span class="s1"> \\</span>
<span class="s1">n_\text</span><span class="si">{core}</span><span class="s1"> &amp;= </span><span class="si">%s</span><span class="s1"> \\</span>
<span class="s1">n_\text</span><span class="si">{cladd}</span><span class="s1"> &amp;= </span><span class="si">%s</span><span class="s1"> \\</span>
<span class="s1">m = </span><span class="si">%d</span><span class="s1"> \\</span>
<span class="s1">A_e &amp;= </span><span class="si">%s</span><span class="s1"> \\</span>
<span class="s1">A_h &amp;= </span><span class="si">%s</span><span class="s1"> \\</span>
<span class="s1">B_e &amp;= </span><span class="si">%s</span><span class="s1"> \\</span>
<span class="s1">B_h &amp;= </span><span class="si">%s</span><span class="s1"> \\</span>
<span class="s1">k_z &amp;= </span><span class="si">%s</span><span class="s1">\,\mu\text</span><span class="si">{m}</span><span class="s1">^{-1} \\</span>
<span class="s1">\gamma &amp;= </span><span class="si">%s</span><span class="s1">\,\mu\text</span><span class="si">{m}</span><span class="s1">^{-1} \\</span>
<span class="s1">\beta &amp;= </span><span class="si">%s</span><span class="s1">\,\mu\text</span><span class="si">{m}</span><span class="s1">^{-1} \\</span>
<span class="s1">\end{align*}&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">num2tex</span><span class="p">(</span><span class="n">fiber_spec</span><span class="p">[</span><span class="s1">&#39;coreRadius&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">),</span>
                   <span class="n">ws</span><span class="o">.</span><span class="n">num2tex</span><span class="p">(</span><span class="n">fiber_spec</span><span class="p">[</span><span class="s1">&#39;nCore&#39;</span><span class="p">],</span><span class="mi">3</span><span class="p">),</span>
                   <span class="n">ws</span><span class="o">.</span><span class="n">num2tex</span><span class="p">(</span><span class="n">fiber_spec</span><span class="p">[</span><span class="s1">&#39;nCladding&#39;</span><span class="p">],</span><span class="mi">3</span><span class="p">),</span>
                   <span class="n">m</span><span class="p">,</span>
                   <span class="n">ws</span><span class="o">.</span><span class="n">num2tex</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">ws</span><span class="o">.</span><span class="n">num2tex</span><span class="p">(</span><span class="n">Ah</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                   <span class="n">ws</span><span class="o">.</span><span class="n">num2tex</span><span class="p">(</span><span class="n">Be</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">ws</span><span class="o">.</span><span class="n">num2tex</span><span class="p">(</span><span class="n">Bh</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                   <span class="n">ws</span><span class="o">.</span><span class="n">num2tex</span><span class="p">(</span><span class="n">kz</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                   <span class="n">ws</span><span class="o">.</span><span class="n">num2tex</span><span class="p">(</span><span class="n">γ</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">ws</span><span class="o">.</span><span class="n">num2tex</span><span class="p">(</span><span class="n">β</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ws</span><span class="o">.</span><span class="n">latex_eqn_to_png</span><span class="p">(</span><span class="n">mode_info</span><span class="p">,</span> <span class="s1">&#39;modeTE00&#39;</span><span class="p">,</span> <span class="n">timed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coord_layout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">coordinate_layout</span><span class="p">(</span><span class="n">fiber_sol</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Δs</span><span class="p">,</span> <span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">ρrange</span><span class="p">,</span> <span class="n">φrange</span><span class="p">,</span> <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">ρg</span><span class="p">,</span> <span class="n">φg</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">crossMask</span><span class="p">,</span> <span class="n">numSamples</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coord_layout&#39;</span><span class="p">]</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="###Plot-the-mode">
<h3>###Plot the mode<a class="headerlink" href="####Plot-the-mode" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.axes_divider</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[264]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Δs</span><span class="p">,</span> <span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">ρrange</span><span class="p">,</span> <span class="n">φrange</span><span class="p">,</span> <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">ρg</span><span class="p">,</span> <span class="n">φg</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">crossMask</span><span class="p">,</span> <span class="n">numSamples</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coord_layout&#39;</span><span class="p">]</span>
<span class="n">nCore</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCore&#39;</span><span class="p">]</span>
<span class="n">nCladding</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCladding&#39;</span><span class="p">]</span>
<span class="n">λfree</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;λFree&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[265]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annotations</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">modtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;TM&#39;</span><span class="p">,</span><span class="s1">&#39;HE&#39;</span><span class="p">]:</span>
    <span class="n">solkey</span> <span class="o">=</span> <span class="n">modtype</span> <span class="o">+</span> <span class="s1">&#39;kz&#39;</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">kzs</span> <span class="ow">in</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="n">solkey</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">kzidx</span><span class="p">,</span> <span class="n">kz</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kzs</span><span class="p">):</span>
            <span class="n">γ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nCore</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">kz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">β</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">nCladding</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">annotationTR</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">modtype</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">kzidx</span><span class="p">)</span>
            <span class="n">annotationBR</span> <span class="o">=</span> <span class="s1">&#39;kz=</span><span class="si">%.3f</span><span class="s1"> µm⁻¹&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kz</span><span class="p">)</span>
            <span class="n">annotations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">annotationTR</span><span class="p">,</span> <span class="n">annotationBR</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[266]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot one</span>
<span class="k">def</span> <span class="nf">fmt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;0&#39;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.1e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">{}</span><span class="s1"> E{{</span><span class="si">{}</span><span class="s1">}}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="n">eigenbasis</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;eigenbasis&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;dark_background&#39;</span><span class="p">)</span>
<span class="n">component_index</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Et_ρ&quot;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Et_ϕ&quot;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Ht_ρ&quot;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Ht_ϕ&quot;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)}</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">extent</span>  <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>
<span class="k">for</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">]:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">]:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">watermelon</span>
        <span class="k">if</span> <span class="n">fun_picker</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">:</span>
            <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Re{</span><span class="si">%s</span><span class="s1">}&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Im{</span><span class="si">%s</span><span class="s1">}&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ember</span>
        <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;|</span><span class="si">%s</span><span class="s1">|&#39;</span>
    <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">ci</span> <span class="ow">in</span> <span class="n">component_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">field</span>   <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;eigenbasis&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span> <span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">field</span>   <span class="o">=</span> <span class="n">fun_picker</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">fun_picker</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fun_picker</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">:</span>
                <span class="n">fun_picker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span>
                <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Im{</span><span class="si">%s</span><span class="s1">}&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fun_picker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span>
                <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Re{</span><span class="si">%s</span><span class="s1">}&#39;</span>
            <span class="n">field</span>   <span class="o">=</span> <span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">field</span>   <span class="o">=</span> <span class="n">fun_picker</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">]:</span>
            <span class="n">themax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">themax</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">themax</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">themax</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">themax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">vmax</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iplot</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">field</span><span class="p">,</span>
                <span class="c1"># vmin=vmin,</span>
                <span class="c1"># vmax=vmax,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmax</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
                <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_format</span> <span class="o">%</span> <span class="n">component</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axis</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axis</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">iplot</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/onesight_15_0.png" class="no-scaled-link" src="_images/onesight_15_0.png" style="width: 979px; height: 788px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/onesight_15_1.png" class="no-scaled-link" src="_images/onesight_15_1.png" style="width: 979px; height: 788px;" />
</div>
</div>
</section>
<section id="###Launching-fields-across-the-end-of-the-waveguide">
<h3>###Launching fields across the end of the waveguide<a class="headerlink" href="####Launching-fields-across-the-end-of-the-waveguide" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">totalModes</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;totalModes&#39;</span><span class="p">]</span>
<span class="n">λfree</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;λFree&#39;</span><span class="p">]</span>
<span class="n">eigenbasis</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;eigenbasis&#39;</span><span class="p">]</span>
<span class="n">nCore</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCore&#39;</span><span class="p">]</span>
<span class="n">nCladding</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCladding&#39;</span><span class="p">]</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Δs</span><span class="p">,</span> <span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">ρrange</span><span class="p">,</span> <span class="n">φrange</span><span class="p">,</span> <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">ρg</span><span class="p">,</span> <span class="n">φg</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">crossMask</span><span class="p">,</span> <span class="n">numSamples</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coord_layout&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annotations</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">modtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;TM&#39;</span><span class="p">,</span><span class="s1">&#39;HE&#39;</span><span class="p">]:</span>
    <span class="n">solkey</span> <span class="o">=</span> <span class="n">modtype</span> <span class="o">+</span> <span class="s1">&#39;kz&#39;</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">kzs</span> <span class="ow">in</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="n">solkey</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">kzidx</span><span class="p">,</span> <span class="n">kz</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kzs</span><span class="p">):</span>
            <span class="n">γ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nCore</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">kz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">β</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">nCladding</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">annotationTR</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">modtype</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">kzidx</span><span class="p">)</span>
            <span class="n">annotationBR</span> <span class="o">=</span> <span class="s1">&#39;kz=</span><span class="si">%.3f</span><span class="s1"> µm⁻¹&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kz</span><span class="p">)</span>
            <span class="n">annotations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">annotationTR</span><span class="p">,</span> <span class="n">annotationBR</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nFree</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">annot</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="c1"># pick the E and H fields</span>
<span class="n">Einc</span> <span class="o">=</span> <span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">Hinc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:])</span>
<span class="n">kref</span><span class="p">,</span> <span class="n">Eref</span><span class="p">,</span> <span class="n">Href</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">poyntingrefractor</span><span class="p">(</span><span class="n">Einc</span><span class="p">,</span> <span class="n">Hinc</span><span class="p">,</span> <span class="n">nFree</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Calculating the Poynting vector field...
Calculating the magnitude of the Poynting field...
Calculating the transverse component of the Poynting field...
Calculating the unit vector in the direction of the Poynting vector...
Calculating the angle of incidence field...
Calculating the angle of refraction field...
Calculating the Fresnel coefficients...
Calculating the ζ of the local coord system...
Calculating the S and P component of the incident electric field...
Calculating the S and P component of the refracted electric field...
Calculating the total refracted electric field...
Calculating the refracted wavevector (normalized) field...
Calculating the refracted H field...
</pre></div></div>
</div>
</section>
<section id="###Convert-cylindrical-anchored-to-cartesian-into-cartesian-anchored-to-cartesian">
<h3>###Convert cylindrical anchored to cartesian into cartesian anchored to cartesian<a class="headerlink" href="####Convert-cylindrical-anchored-to-cartesian-into-cartesian-anchored-to-cartesian" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[271]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Δs</span><span class="p">,</span> <span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">ρrange</span><span class="p">,</span> <span class="n">φrange</span><span class="p">,</span> <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">ρg</span><span class="p">,</span> <span class="n">φg</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">crossMask</span><span class="p">,</span> <span class="n">numSamples</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coord_layout&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[272]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Erefcc</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">from_cyl_cart_to_cart_cart</span><span class="p">(</span><span class="n">Eref</span><span class="p">)</span>
<span class="n">Hrefcc</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">from_cyl_cart_to_cart_cart</span><span class="p">(</span><span class="n">Href</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[273]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this might take about a minute or so</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span>
              <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">ccfield</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
              <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">ccfield</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/onesight_23_0.png" class="no-scaled-link" src="_images/onesight_23_0.png" style="width: 540px; height: 525px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[274]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ErefFuns</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">HrefFuns</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">field_idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">refField</span> <span class="o">=</span> <span class="p">[</span><span class="n">Erefcc</span><span class="p">,</span> <span class="n">Hrefcc</span><span class="p">][</span><span class="n">field_idx</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">theFieldComponent</span> <span class="o">=</span> <span class="n">refField</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">fieldInterpol</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">((</span><span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">),</span>
                        <span class="n">theFieldComponent</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ErefFuns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fieldInterpol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">HrefFuns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fieldInterpol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[275]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">numSamples</span><span class="p">,</span> <span class="n">xCoords</span><span class="p">,</span> <span class="n">yCoords</span><span class="p">,</span> <span class="n">E3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">vectorfieldprop</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">ErefFuns</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">numSamples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xrange</span><span class="p">),</span> <span class="n">interpFun</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">(</span><span class="n">numSamples</span><span class="p">,</span> <span class="n">xCoords</span><span class="p">,</span> <span class="n">yCoords</span><span class="p">,</span> <span class="n">H3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">vectorfieldprop</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">HrefFuns</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">numSamples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xrange</span><span class="p">),</span> <span class="n">interpFun</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[275], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> (numSamples, xCoords, yCoords, E3) = ws.vectorfieldprop(2*b, 10., ErefFuns, 0.6, 1.0, numSamples=len(xrange), interpFun=True)
<span class="ansi-green-intense-fg ansi-bold">      2</span> (numSamples, xCoords, yCoords, H3) = ws.vectorfieldprop(2*b, 10., HrefFuns, 0.6, 1.0, numSamples=len(xrange), interpFun=True)

<span class="ansi-red-fg">AttributeError</span>: module &#39;wavesight&#39; has no attribute &#39;vectorfieldprop&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">λFree</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">nHost</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">λHost</span> <span class="o">=</span> <span class="n">λFree</span> <span class="o">/</span> <span class="n">nHost</span>
<span class="n">Rmax</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># arbitrary</span>
<span class="n">Δ</span> <span class="o">=</span> <span class="n">dev_design</span><span class="p">[</span><span class="s1">&#39;Δ&#39;</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">fresnel_profile</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">phase_fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">phase_fun</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fp</span> <span class="o">=</span> <span class="n">fresnel_profile</span><span class="p">(</span><span class="n">Δ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phase_map</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">λHost</span> <span class="o">*</span> <span class="n">fp</span><span class="p">(</span><span class="n">Xg</span><span class="p">,</span><span class="n">Yg</span><span class="p">)</span>
<span class="n">complex_phase_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase_map</span><span class="p">)</span>
<span class="n">complex_phase_map</span><span class="p">[</span><span class="n">Xg</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Yg</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">Rmax</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">complex_phase_map</span><span class="p">),</span>
        <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">watermelon</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/um&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/um&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Phase Map&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/onesight_29_0.png" class="no-scaled-link" src="_images/onesight_29_0.png" style="width: 448px; height: 454px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E4</span> <span class="o">=</span> <span class="n">E3</span> <span class="o">*</span> <span class="n">complex_phase_map</span>
<span class="n">H4</span> <span class="o">=</span> <span class="n">H3</span> <span class="o">*</span> <span class="n">complex_phase_map</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">E4</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
        <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">watermelon</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/um&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/um&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;|E4_z|&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/onesight_31_0.png" class="no-scaled-link" src="_images/onesight_31_0.png" style="width: 448px; height: 454px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dev_design</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coreRadius&#39;</span><span class="p">:</span><span class="mf">25.</span><span class="p">,</span> <span class="s1">&#39;mlRadius&#39;</span><span class="p">:</span><span class="mf">50.</span><span class="p">,</span> <span class="s1">&#39;Δ&#39;</span><span class="p">:</span><span class="mf">15.</span><span class="p">,</span> <span class="s1">&#39;mlPitch&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span><span class="s1">&#39;NA&#39;</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span>
              <span class="s1">&#39;emDepth&#39;</span><span class="p">:</span><span class="mf">50.</span><span class="p">,</span> <span class="s1">&#39;emΔxy&#39;</span><span class="p">:</span><span class="mf">5.</span><span class="p">,</span> <span class="s1">&#39;emΔz&#39;</span><span class="p">:</span><span class="mf">10.</span><span class="p">,</span> <span class="s1">&#39;mlHeight&#39;</span><span class="p">:</span><span class="mf">0.7</span><span class="p">,</span>
              <span class="s1">&#39;nCore&#39;</span><span class="p">:</span><span class="mf">1.45</span><span class="p">,</span> <span class="s1">&#39;nHost&#39;</span><span class="p">:</span><span class="mf">2.41</span><span class="p">,</span> <span class="s1">&#39;nCore&#39;</span><span class="p">:</span><span class="mf">1.45</span><span class="p">,</span> <span class="s1">&#39;λFree&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dl</span> <span class="o">=</span> <span class="n">xrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">emΔz</span> <span class="o">=</span> <span class="n">dev_design</span><span class="p">[</span><span class="s1">&#39;emΔz&#39;</span><span class="p">]</span>
<span class="n">emDepth</span> <span class="o">=</span> <span class="n">dev_design</span><span class="p">[</span><span class="s1">&#39;emDepth&#39;</span><span class="p">]</span>
<span class="n">zrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">emDepth</span><span class="o">-</span><span class="n">emΔz</span><span class="p">,</span> <span class="n">emDepth</span><span class="o">+</span><span class="n">emΔz</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">emΔz</span><span class="o">/</span><span class="n">dl</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">E4</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zrange</span><span class="p">)))</span>
<span class="n">H5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">H4</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zrange</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[276]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E4Funs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">H4Funs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">field_idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">refField</span> <span class="o">=</span> <span class="p">[</span><span class="n">E4</span><span class="p">,</span> <span class="n">H4</span><span class="p">][</span><span class="n">field_idx</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">theFieldComponent</span> <span class="o">=</span> <span class="n">refField</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">fieldInterpol</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">((</span><span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">),</span>
                        <span class="n">theFieldComponent</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                        <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">E4Funs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fieldInterpol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">H4Funs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fieldInterpol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[278]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">field_index</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">field_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">fieldFuns</span> <span class="o">=</span> <span class="n">E4Funs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fieldFuns</span> <span class="o">=</span> <span class="n">H4Funs</span>
    <span class="k">for</span> <span class="n">z_index</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zrange</span><span class="p">):</span>
        <span class="p">(</span><span class="n">numSamples</span><span class="p">,</span> <span class="n">xCoords</span><span class="p">,</span> <span class="n">yCoords</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">vector_field_FFT_RS_prop_func</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">fieldFuns</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">nHost</span><span class="p">,</span> <span class="n">numSamples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xrange</span><span class="p">),</span> <span class="n">interpFun</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">E5</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">z_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">H5</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">z_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[279]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">slice</span> <span class="o">=</span> <span class="n">E5</span><span class="p">[:,</span> <span class="mi">181</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="nb">slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="nb">slice</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[281]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">slice</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="nb">slice</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">zrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">zrange</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmr</span><span class="o">.</span><span class="n">ember</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmax</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x/um&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;z/um&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;|E|^2&#39;</span><span class="p">)</span>
<span class="c1">#plt.xlim(-10,10)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/onesight_38_0.png" class="no-scaled-link" src="_images/onesight_38_0.png" style="width: 733px; height: 238px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[251]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlHeight</span> <span class="o">=</span> <span class="n">dev_design</span><span class="p">[</span><span class="s1">&#39;mlHeight&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[254]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dev_design</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coreRadius&#39;</span><span class="p">:</span><span class="mf">25.</span><span class="p">,</span> <span class="s1">&#39;mlRadius&#39;</span><span class="p">:</span><span class="mf">50.</span><span class="p">,</span> <span class="s1">&#39;Δ&#39;</span><span class="p">:</span><span class="mf">15.</span><span class="p">,</span> <span class="s1">&#39;mlPitch&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span><span class="s1">&#39;NA&#39;</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span>
              <span class="s1">&#39;emDepth&#39;</span><span class="p">:</span><span class="mf">50.</span><span class="p">,</span> <span class="s1">&#39;emΔxy&#39;</span><span class="p">:</span><span class="mf">5.</span><span class="p">,</span> <span class="s1">&#39;emΔz&#39;</span><span class="p">:</span><span class="mf">10.</span><span class="p">,</span> <span class="s1">&#39;mlHeight&#39;</span><span class="p">:</span><span class="mf">0.7</span><span class="p">,</span>
              <span class="s1">&#39;nCore&#39;</span><span class="p">:</span><span class="mf">1.45</span><span class="p">,</span> <span class="s1">&#39;nHost&#39;</span><span class="p">:</span><span class="mf">2.41</span><span class="p">,</span> <span class="s1">&#39;nCore&#39;</span><span class="p">:</span><span class="mf">1.45</span><span class="p">,</span> <span class="s1">&#39;λFree&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">}</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">device_layout</span><span class="p">(</span><span class="n">dev_design</span><span class="p">)</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">slice</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="nb">slice</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
        <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">zrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">Δ</span><span class="p">,</span><span class="n">zrange</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Δ</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmr</span><span class="o">.</span><span class="n">ember</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmax</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
        <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/um&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;z/um&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;|E|^2&#39;</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[254]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="_images/onesight_40_0.png" class="no-scaled-link" src="_images/onesight_40_0.png" style="width: 397px; height: 454px;" />
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>