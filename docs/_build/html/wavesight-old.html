<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>#WaveSight &mdash; wavesight  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            wavesight
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="docs/wavesight.html">wavesight.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/fields.html">fields.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/maxwell.html">Maxwell’s Equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/diffkernels.html">diffkernels.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/misc.html">misc.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/fieldgenesis.html">fieldgenesis.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/fungenerators.html">fungenerators.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs/convstore.html">convstore.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="farfield.html"># Farfield Propagators</a></li>
<li class="toctree-l1"><a class="reference internal" href="multifiber.html"># Multifiber</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">wavesight</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">#WaveSight</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/wavesight-old.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="#WaveSight">
<h1>#WaveSight<a class="headerlink" href="##WaveSight" title="Link to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="kn">import</span> <span class="nn">wavesight</span> <span class="k">as</span> <span class="nn">ws</span>
<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">special</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span><span class="p">,</span> <span class="n">root_scalar</span>
<span class="kn">import</span> <span class="nn">cmasher</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.axes_divider</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format=&#39;retina&#39;
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning disabling RuntimeWarning often due to evalution of square roots with negative arguments.</span><span class="se">\n</span><span class="s2">Probably produced by scalar_root.&quot;</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Warning disabling RuntimeWarning often due to evalution of square roots with negative arguments.
Probably produced by scalar_root.
</pre></div></div>
</div>
<section id="##Step-index-cylindrical-waveguide">
<h2>##Step-index cylindrical waveguide<a class="headerlink" href="###Step-index-cylindrical-waveguide" title="Link to this heading">¶</a></h2>
<section id="###The-trascendental-equation-for-kz">
<h3>###The trascendental equation for kz<a class="headerlink" href="####The-trascendental-equation-for-kz" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nCore</span> <span class="o">=</span> <span class="mf">1.45</span>
<span class="n">nCladding</span> <span class="o">=</span> <span class="mf">1.387</span>
<span class="n">coreRadius</span> <span class="o">=</span> <span class="mf">3.</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">tmfun</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">tmfungen</span><span class="p">(</span><span class="n">λfree</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span>
                 <span class="n">n2</span><span class="o">=</span><span class="n">nCladding</span><span class="p">,</span>
                 <span class="n">n1</span><span class="o">=</span><span class="n">nCore</span><span class="p">,</span>
                 <span class="n">a</span><span class="o">=</span><span class="n">coreRadius</span><span class="p">)</span>
<span class="n">kzmax</span> <span class="o">=</span> <span class="mf">1.001</span><span class="o">*</span><span class="n">nCore</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">wavelength</span>
<span class="n">kzmin</span> <span class="o">=</span> <span class="mf">0.999</span><span class="o">*</span><span class="n">nCladding</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">wavelength</span>
<span class="n">kzrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">kzmin</span><span class="p">,</span> <span class="n">kzmax</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">tmvals</span> <span class="o">=</span> <span class="n">tmfun</span><span class="p">(</span><span class="n">kzrange</span><span class="p">)</span>
<span class="n">tmzeros</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">findallroots</span><span class="p">(</span><span class="n">tmfun</span><span class="p">,</span> <span class="n">kzmin</span><span class="p">,</span> <span class="n">kzmax</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">real_dtype</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bisect&#39;</span><span class="p">,</span> <span class="n">num_sigfigs</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tmzerocheck</span> <span class="o">=</span> <span class="n">tmfun</span><span class="p">(</span><span class="n">tmzeros</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kzrange</span><span class="p">,</span> <span class="n">tmvals</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tmzeros</span><span class="p">,</span><span class="n">tmzerocheck</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">kzmin</span><span class="p">,</span> <span class="n">kzmax</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;w:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_4_0.png" class="no-scaled-link" src="_images/wavesight-old_4_0.png" style="width: 610px; height: 306px;" />
</div>
</div>
</section>
<section id="###ws.multisolver">
<h3>###ws.multisolver<a class="headerlink" href="####ws.multisolver" title="Link to this heading">¶</a></h3>
<p>Solve the propagation constants of a fiber of the given geometry and plot the axial field together with density plots for the tangential field.</p>
<p>Calculate a numerical basis using the calculated modes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fiber_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;NA&#39;</span><span class="p">:</span> <span class="mf">0.39</span><span class="p">,</span>
              <span class="s1">&#39;nCore&#39;</span><span class="p">:</span> <span class="mf">1.45</span><span class="p">,</span>
              <span class="s1">&#39;coreRadius&#39;</span><span class="p">:</span><span class="mf">3.</span><span class="p">,</span>
              <span class="s1">&#39;free_space_wavelength&#39;</span><span class="p">:</span> <span class="mf">0.600</span><span class="p">}</span>
<span class="n">fiber_sol</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">multisolver</span><span class="p">(</span><span class="n">fiber_spec</span><span class="p">,</span> <span class="n">drawPlots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
========================================
Approx number of complex HE modes:  31
Approx number of TE modes:  6
Approx number of TM modes:  6
Approx number of total modes:  75
Approx Max n for HE modes:  7
========================================
Calculting TE(0,n) propagation constants ...
Calculting TM(0,n) propagation constants ...
Calculting HE(m,n) propagation constants ...
m=10
========================================
HE modes = 68
TE modes = 8
TM modes = 8
TOTAL modes = 84
FROM_Vnum = 75
========================================
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TEcounter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span><span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;HEkz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">TEcounter</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_8_0.png" class="no-scaled-link" src="_images/wavesight-old_8_0.png" style="width: 362px; height: 248px;" />
</div>
</div>
<section id="####HE-modes">
<h4>####HE modes<a class="headerlink" href="#####HE-modes" title="Link to this heading">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coreRadius&#39;</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="mf">1.5</span> <span class="c1"># assumed, in reality the cladding is assumed to be infinite</span>
<span class="n">nCore</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCore&#39;</span><span class="p">]</span>
<span class="n">nCladding</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCladding&#39;</span><span class="p">]</span>

<span class="c1"># given a value for m, plot the axial and transverse fields</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">kz</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;HEkz&#39;</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">λfree</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;free_space_wavelength&#39;</span><span class="p">]</span>
<span class="n">γ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nCore</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">kz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">β</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">nCladding</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">AeAhBeBh</span><span class="p">(</span><span class="s2">&quot;HE&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">nCore</span><span class="p">,</span> <span class="n">nCladding</span><span class="p">,</span> <span class="n">λfree</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">kz</span><span class="p">)</span>

<span class="n">Ez_1</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Ezgen_1</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">γ</span><span class="p">)</span>
<span class="n">Ez_2</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Ezgen_2</span><span class="p">(</span><span class="n">Be</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">)</span>
<span class="n">Hz_1</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Hzgen_1</span><span class="p">(</span><span class="n">Ah</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">γ</span><span class="p">)</span>
<span class="n">Hz_2</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Hzgen_2</span><span class="p">(</span><span class="n">Bh</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">)</span>

<span class="n">Et1</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Et1gen_1</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">γ</span><span class="p">,</span> <span class="n">kz</span><span class="p">,</span> <span class="n">λfree</span><span class="p">)</span>
<span class="n">Et2</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Et2gen_1</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">γ</span><span class="p">,</span> <span class="n">kz</span><span class="p">,</span> <span class="n">λfree</span><span class="p">)</span>
<span class="n">Ht1</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Ht1gen_1</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">γ</span><span class="p">,</span> <span class="n">kz</span><span class="p">,</span> <span class="n">λfree</span><span class="p">,</span> <span class="n">nCore</span><span class="p">)</span>
<span class="n">Ht2</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Ht2gen_1</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">γ</span><span class="p">,</span> <span class="n">kz</span><span class="p">,</span> <span class="n">λfree</span><span class="p">,</span> <span class="n">nCladding</span><span class="p">)</span>

<span class="n">ρrangein</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">ρrangeout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">Ezvals1</span> <span class="o">=</span> <span class="n">Ez_1</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">)</span>
<span class="n">Ezvals2</span> <span class="o">=</span> <span class="n">Ez_2</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">)</span>
<span class="n">Hzvals1</span> <span class="o">=</span> <span class="n">Hz_1</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">)</span>
<span class="n">Hzvals2</span> <span class="o">=</span> <span class="n">Hz_2</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ezvals1</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re(Ez)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ezvals2</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ezvals1</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Im(Ez)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ezvals2</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;ρ/µm&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Hzvals1</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re(Hz)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Hzvals2</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Hzvals1</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Im(Hz)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Hzvals2</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;ρ/µm&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_10_0.png" class="no-scaled-link" src="_images/wavesight-old_10_0.png" style="width: 617px; height: 316px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">yrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">)</span>
<span class="n">Etvals1</span> <span class="o">=</span> <span class="n">Et1</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">Etvals2</span> <span class="o">=</span> <span class="n">Et2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">Htvals1</span> <span class="o">=</span> <span class="n">Ht1</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">Htvals2</span> <span class="o">=</span> <span class="n">Ht2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fieldarray1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,])</span>
<span class="n">fieldarray1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fieldarray2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,])</span>
<span class="n">fieldarray2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fieldarray_x</span> <span class="o">=</span> <span class="n">fieldarray1</span> <span class="o">+</span> <span class="n">fieldarray2</span>

<span class="n">fieldarray1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,])</span>
<span class="n">fieldarray1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fieldarray2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,])</span>
<span class="n">fieldarray2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fieldarray_y</span> <span class="o">=</span> <span class="n">fieldarray1</span> <span class="o">+</span> <span class="n">fieldarray2</span>

<span class="n">fieldarray1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,])</span><span class="o">**</span><span class="mi">2</span>
<span class="n">fieldarray1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fieldarray2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,])</span><span class="o">**</span><span class="mi">2</span>
<span class="n">fieldarray2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fieldarray_mag2</span> <span class="o">=</span> <span class="n">fieldarray1</span> <span class="o">+</span> <span class="n">fieldarray2</span>

<span class="n">fieldarray1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,])</span>
<span class="n">fieldarray1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fieldarray2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,])</span>
<span class="n">fieldarray2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fieldarray_xim</span> <span class="o">=</span> <span class="n">fieldarray1</span> <span class="o">+</span> <span class="n">fieldarray2</span>

<span class="n">fieldarray1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,])</span>
<span class="n">fieldarray1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fieldarray2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,])</span>
<span class="n">fieldarray2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fieldarray_yim</span> <span class="o">=</span> <span class="n">fieldarray1</span> <span class="o">+</span> <span class="n">fieldarray2</span>

<span class="n">plotfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">fieldarray_x</span><span class="p">,</span> <span class="n">fieldarray_y</span><span class="p">,</span> <span class="n">fieldarray_mag2</span><span class="p">,</span> <span class="n">fieldarray_xim</span><span class="p">,</span> <span class="n">fieldarray_yim</span><span class="p">]</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Re(Et_x)&#39;</span><span class="p">,</span> <span class="s1">&#39;Re(Et_y)&#39;</span><span class="p">,</span> <span class="s1">&#39;|Et|^2&#39;</span><span class="p">,</span> <span class="s1">&#39;Im(Et_x)&#39;</span><span class="p">,</span> <span class="s1">&#39;Im(Et_y)&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">pfield</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">plotfields</span><span class="p">,</span> <span class="n">labels</span><span class="p">)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">idx</span><span class="o">%</span><span class="k">3</span>]
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;|Et|^2&#39;</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ember</span>
        <span class="n">maxmag2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fieldarray_mag2</span><span class="p">)</span>
        <span class="n">iplot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fieldarray_mag2</span><span class="p">,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">maxmag2</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maxmag2</span><span class="p">),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">watermelon</span>
        <span class="n">iplot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pfield</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">iplot</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_12_0.png" class="no-scaled-link" src="_images/wavesight-old_12_0.png" style="width: 1071px; height: 671px;" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ex1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:])</span>
<span class="n">Ex1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Ex2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:])</span>
<span class="n">Ex2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Ex</span> <span class="o">=</span> <span class="n">Ex1</span> <span class="o">+</span> <span class="n">Ex2</span>
<span class="n">Ey1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:])</span>
<span class="n">Ey1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Ey2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:])</span>
<span class="n">Ey2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Ey</span> <span class="o">=</span> <span class="n">Ey1</span> <span class="o">+</span> <span class="n">Ey2</span>

<span class="n">Hx1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Htvals1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:])</span>
<span class="n">Hx1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Hx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Htvals2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:])</span>
<span class="n">Hx2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Hx</span> <span class="o">=</span> <span class="n">Hx1</span> <span class="o">+</span> <span class="n">Hx2</span>
<span class="n">Hy1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Htvals1</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:])</span>
<span class="n">Hy1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Hy2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Htvals2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:])</span>
<span class="n">Hy2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Hy</span> <span class="o">=</span> <span class="n">Hy1</span> <span class="o">+</span> <span class="n">Hy2</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">Hx</span><span class="p">,</span> <span class="n">Hy</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_13_0.png" class="no-scaled-link" src="_images/wavesight-old_13_0.png" style="width: 607px; height: 313px;" />
</div>
</div>
</section>
<section id="####TM-and-TE-modes">
<h4>####TM and TE modes<a class="headerlink" href="#####TM-and-TE-modes" title="Link to this heading">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># def AeTE(a, n1, n2, λfree, kz):</span>
<span class="c1">#     return 1</span>

<span class="c1"># def AhTE(a, n1, n2, λfree, kz):</span>
<span class="c1">#     return 0</span>

<span class="c1"># def BeTE(a, n1, n2, λfree, kz):</span>
<span class="c1">#     return special.jv(0, a*np.sqrt(-kz**2 + (4*n1**2*np.pi**2)/λfree**2))/special.kn(0,a*np.sqrt(kz**2 - (4*n2**2*np.pi**2)/λfree**2))</span>

<span class="c1"># def BhTE(a, n1, n2, λfree, kz):</span>
<span class="c1">#     return 0</span>

<span class="c1"># def AeTM(a, n1, n2, λfree, kz):</span>
<span class="c1">#     return 0</span>

<span class="c1"># def AhTM(a, n1, n2, λfree, kz):</span>
<span class="c1">#     return 1</span>

<span class="c1"># def BeTM(a, n1, n2, λfree, kz):</span>
<span class="c1">#     return 0</span>

<span class="c1"># def BhTM(a, n1, n2, λfree, kz):</span>
<span class="c1">#     return -((np.sqrt(kz**2 - (4*n2**2*np.pi**2)/λfree**2)*special.jv(1,a*np.sqrt(-kz**2 + (4*n1**2*np.pi**2)/λfree**2)))/(np.sqrt(-kz**2 + (4*n1**2*np.pi**2)/λfree**2)*special.kn(1,a*np.sqrt(kz**2 - (4*n2**2*np.pi**2)/λfree**2))))</span>



<span class="c1"># def AeAhBeBhTM(a, n1, n2, λfree, kz):</span>
<span class="c1">#     return (AeTM(a, n1, n2, λfree, kz),</span>
<span class="c1">#             AhTM(a, n1, n2, λfree, kz),</span>
<span class="c1">#             BeTM(a, n1, n2, λfree, kz),</span>
<span class="c1">#             BhTM(a, n1, n2, λfree, kz))</span>

<span class="c1"># def AeAhBeBhTE(a, n1, n2, λfree, kz):</span>
<span class="c1">#     return (AeTE(a, n1, n2, λfree, kz),</span>
<span class="c1">#             AhTE(a, n1, n2, λfree, kz),</span>
<span class="c1">#             BeTE(a, n1, n2, λfree, kz),</span>
<span class="c1">#             BhTE(a, n1, n2, λfree, kz))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coreRadius&#39;</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="mf">1.5</span> <span class="c1"># assumed, in reality the cladding is assumed to be infinite</span>
<span class="n">nCore</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCore&#39;</span><span class="p">]</span>
<span class="n">nCladding</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCladding&#39;</span><span class="p">]</span>

<span class="c1"># given a value for plot the axial and transverse fields</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">λfree</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;free_space_wavelength&#39;</span><span class="p">]</span>

<span class="n">xrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">yrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">)</span>

<span class="k">for</span> <span class="n">modtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;TE&quot;</span><span class="p">,</span><span class="s2">&quot;TM&quot;</span><span class="p">]:</span>
    <span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">AeAhBeBh</span><span class="p">(</span><span class="n">modtype</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">nCore</span><span class="p">,</span> <span class="n">nCladding</span><span class="p">,</span> <span class="n">λfree</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">kz</span><span class="p">)</span>
    <span class="n">kz</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">kz&#39;</span> <span class="o">%</span> <span class="n">modtype</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
    <span class="n">γ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nCore</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">kz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">β</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">nCladding</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span><span class="p">)</span>

    <span class="n">Ez_1</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Ezgen_1</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">γ</span><span class="p">)</span>
    <span class="n">Ez_2</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Ezgen_2</span><span class="p">(</span><span class="n">Be</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">)</span>
    <span class="n">Hz_1</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Hzgen_1</span><span class="p">(</span><span class="n">Ah</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">γ</span><span class="p">)</span>
    <span class="n">Hz_2</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Hzgen_2</span><span class="p">(</span><span class="n">Bh</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">)</span>

    <span class="n">Et1</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Et1gen_1</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">γ</span><span class="p">,</span> <span class="n">kz</span><span class="p">,</span> <span class="n">λfree</span><span class="p">)</span>
    <span class="n">Et2</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Et2gen_1</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">γ</span><span class="p">,</span> <span class="n">kz</span><span class="p">,</span> <span class="n">λfree</span><span class="p">)</span>
    <span class="n">Ht1</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Ht1gen_1</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">γ</span><span class="p">,</span> <span class="n">kz</span><span class="p">,</span> <span class="n">λfree</span><span class="p">,</span> <span class="n">nCore</span><span class="p">)</span>
    <span class="n">Ht2</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">Ht2gen_1</span><span class="p">(</span><span class="n">Ae</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">Be</span><span class="p">,</span> <span class="n">Bh</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">γ</span><span class="p">,</span> <span class="n">kz</span><span class="p">,</span> <span class="n">λfree</span><span class="p">,</span> <span class="n">nCladding</span><span class="p">)</span>

    <span class="n">ρrangein</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">ρrangeout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

    <span class="n">Ezvals1</span> <span class="o">=</span> <span class="n">Ez_1</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">)</span>
    <span class="n">Ezvals2</span> <span class="o">=</span> <span class="n">Ez_2</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">)</span>
    <span class="n">Hzvals1</span> <span class="o">=</span> <span class="n">Hz_1</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">)</span>
    <span class="n">Hzvals2</span> <span class="o">=</span> <span class="n">Hz_2</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">modtype</span> <span class="o">==</span> <span class="s2">&quot;TM&quot;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Hzvals1</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re(Hz)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Hzvals2</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Hzvals1</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Im(Hz)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Hzvals2</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ezvals1</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re(Hz)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ezvals2</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangein</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ezvals1</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Im(Hz)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρrangeout</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ezvals2</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;ρ/µm&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">modtype</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">Etvals1</span> <span class="o">=</span> <span class="n">Et1</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    <span class="n">Etvals2</span> <span class="o">=</span> <span class="n">Et2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    <span class="n">Htvals1</span> <span class="o">=</span> <span class="n">Ht1</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    <span class="n">Htvals2</span> <span class="o">=</span> <span class="n">Ht2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

    <span class="n">fieldarray1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,])</span>
    <span class="n">fieldarray1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fieldarray2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,])</span>
    <span class="n">fieldarray2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fieldarray_xim</span> <span class="o">=</span> <span class="n">fieldarray1</span> <span class="o">+</span> <span class="n">fieldarray2</span>

    <span class="n">fieldarray1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,])</span>
    <span class="n">fieldarray1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fieldarray2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,])</span>
    <span class="n">fieldarray2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fieldarray_yim</span> <span class="o">=</span> <span class="n">fieldarray1</span> <span class="o">+</span> <span class="n">fieldarray2</span>

    <span class="n">fieldarray1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals1</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,])</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">fieldarray1</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fieldarray2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Etvals2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,])</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">fieldarray2</span><span class="p">[</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fieldarray_mag2</span> <span class="o">=</span> <span class="n">fieldarray1</span> <span class="o">+</span> <span class="n">fieldarray2</span>

    <span class="n">plotfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">fieldarray_xim</span><span class="p">,</span> <span class="n">fieldarray_yim</span><span class="p">,</span> <span class="n">fieldarray_mag2</span><span class="p">]</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Im(Et_x)&#39;</span><span class="p">,</span> <span class="s1">&#39;Im(Et_y)&#39;</span><span class="p">,</span> <span class="s1">&#39;|Et|^2&#39;</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">pfield</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">plotfields</span><span class="p">,</span> <span class="n">labels</span><span class="p">)):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;|Et|^2&#39;</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ember</span>
            <span class="n">maxmag2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fieldarray_mag2</span><span class="p">)</span>
            <span class="n">iplot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fieldarray_mag2</span><span class="p">,</span>
                    <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">maxmag2</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maxmag2</span><span class="p">),</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">watermelon</span>
            <span class="n">iplot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pfield</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="mf">1.5</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">iplot</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1 0 -193136.647044981 0.0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_16_1.png" class="no-scaled-link" src="_images/wavesight-old_16_1.png" style="width: 617px; height: 331px;" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_16_2.png" class="no-scaled-link" src="_images/wavesight-old_16_2.png" style="width: 1071px; height: 317px;" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 1 0 -193397.18468008417
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_16_4.png" class="no-scaled-link" src="_images/wavesight-old_16_4.png" style="width: 617px; height: 331px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_16_5.png" class="no-scaled-link" src="_images/wavesight-old_16_5.png" style="width: 1071px; height: 311px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fieldarray1 = np.imag(Etvals1[0,:,])</span>
<span class="c1"># fieldarray1[X**2 + Y**2 &gt; a**2] = 0</span>
<span class="c1"># fieldarray2 = np.imag(Etvals2[0,:,])</span>
<span class="c1"># fieldarray2[X**2 + Y**2 &lt; a**2] = 0</span>
<span class="c1"># fieldarray_xim = fieldarray1 + fieldarray2</span>

<span class="c1"># fieldarray1 = np.imag(Etvals1[1,:,])</span>
<span class="c1"># fieldarray1[X**2 + Y**2 &gt; a**2] = 0</span>
<span class="c1"># fieldarray2 = np.imag(Etvals2[1,:,])</span>
<span class="c1"># fieldarray2[X**2 + Y**2 &lt; a**2] = 0</span>
<span class="c1"># fieldarray_yim = fieldarray1 + fieldarray2</span>

<span class="c1"># fieldarray1 = np.imag(Etvals1[0,:,])**2 + np.imag(Etvals1[1,:,])**2</span>
<span class="c1"># fieldarray1[X**2 + Y**2 &gt; a**2] = 0</span>
<span class="c1"># fieldarray2 = np.imag(Etvals2[0,:,])**2 + np.imag(Etvals2[1,:,])**2</span>
<span class="c1"># fieldarray2[X**2 + Y**2 &lt; a**2] = 0</span>
<span class="c1"># fieldarray_mag2 = fieldarray1 + fieldarray2</span>

<span class="c1"># plotfields = [fieldarray_xim, fieldarray_yim, fieldarray_mag2]</span>

<span class="c1"># labels = [&#39;Im(Et_x)&#39;, &#39;Im(Et_y)&#39;, &#39;|Et|^2&#39;]</span>

<span class="c1"># fig, axes = plt.subplots(nrows = 1, ncols=3, figsize=(15,5))</span>

<span class="c1"># for idx, (pfield, label) in enumerate(zip(plotfields, labels)):</span>
<span class="c1">#     ax = axes[idx]</span>
<span class="c1">#     if label == &#39;|Et|^2&#39;:</span>
<span class="c1">#         cmap = cm.ember</span>
<span class="c1">#         maxmag2 = np.max(fieldarray_mag2)</span>
<span class="c1">#         iplot = ax.imshow(fieldarray_mag2,</span>
<span class="c1">#                 norm=LogNorm(vmin=maxmag2*1e-3, vmax=maxmag2),</span>
<span class="c1">#                 cmap=cmap,</span>
<span class="c1">#                 extent=[-a*1.5, a*1.5, -a*1.5, a*1.5])</span>
<span class="c1">#     else:</span>
<span class="c1">#         cmap = cm.watermelon</span>
<span class="c1">#         iplot = ax.imshow(pfield,</span>
<span class="c1">#             cmap=cmap,</span>
<span class="c1">#             extent=[-a*1.5, a*1.5, -a*1.5, a*1.5])</span>
<span class="c1">#     ax.set_title(label)</span>
<span class="c1">#     ax.set_xlabel(&#39;x/µm&#39;)</span>
<span class="c1">#     ax.set_ylabel(&#39;y/µm&#39;)</span>
<span class="c1">#     divider = make_axes_locatable(ax)</span>
<span class="c1">#     cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.2)</span>
<span class="c1">#     plt.colorbar(iplot, cax=cax)</span>
<span class="c1"># plt.tight_layout()</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ex1 = np.imag(Etvals1[0,:,:])</span>
<span class="c1"># Ex1[X**2 + Y**2 &gt; a**2] = 0</span>
<span class="c1"># Ex2 = np.imag(Etvals2[0,:,:])</span>
<span class="c1"># Ex2[X**2 + Y**2 &lt; a**2] = 0</span>
<span class="c1"># Ex = Ex1 + Ex2</span>
<span class="c1"># Ey1 = np.imag(Etvals1[1,:,:])</span>
<span class="c1"># Ey1[X**2 + Y**2 &gt; a**2] = 0</span>
<span class="c1"># Ey2 = np.imag(Etvals2[1,:,:])</span>
<span class="c1"># Ey2[X**2 + Y**2 &lt; a**2] = 0</span>
<span class="c1"># Ey = Ey1 + Ey2</span>

<span class="c1"># Hx1 = np.imag(Htvals1[0,:,:])</span>
<span class="c1"># Hx1[X**2 + Y**2 &gt; a**2] = 0</span>
<span class="c1"># Hx2 = np.imag(Htvals2[0,:,:])</span>
<span class="c1"># Hx2[X**2 + Y**2 &lt; a**2] = 0</span>
<span class="c1"># Hx = Hx1 + Hx2</span>
<span class="c1"># Hy1 = np.imag(Htvals1[1,:,:])</span>
<span class="c1"># Hy1[X**2 + Y**2 &gt; a**2] = 0</span>
<span class="c1"># Hy2 = np.imag(Htvals2[1,:,:])</span>
<span class="c1"># Hy2[X**2 + Y**2 &lt; a**2] = 0</span>
<span class="c1"># Hy = Hy1 + Hy2</span>

<span class="c1"># fig, axes = plt.subplots(ncols=2, figsize=(10,5))</span>
<span class="c1"># axes[0].streamplot(xrange, yrange, Ex, Ey, arrowstyle=&#39;-&#39;, density=2)</span>
<span class="c1"># axes[0].set_xlabel(&#39;x/µm&#39;)</span>
<span class="c1"># axes[0].set_ylabel(&#39;y/µm&#39;)</span>
<span class="c1"># axes[0].set_title(&#39;E&#39;)</span>
<span class="c1"># axes[0].set_aspect(&#39;equal&#39;)</span>

<span class="c1"># axes[1].streamplot(xrange, yrange, Hx, Hy, arrowstyle=&#39;-&#39;, density=2)</span>
<span class="c1"># axes[1].set_xlabel(&#39;x/µm&#39;)</span>
<span class="c1"># axes[1].set_ylabel(&#39;y/µm&#39;)</span>
<span class="c1"># axes[1].set_title(&#39;H&#39;)</span>
<span class="c1"># axes[1].set_aspect(&#39;equal&#39;)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ae, Ah, Be, Bh = ws.AeAhBeBh(&quot;TE&quot;, a, nCore, nCladding, λfree, m, kz)</span>

<span class="c1"># print(Ae, Ah, Be, Bh)</span>

<span class="c1"># Ez_1 = ws.Ezgen_1(Ae, m, γ)</span>
<span class="c1"># Ez_2 = ws.Ezgen_2(Be, m, β)</span>
<span class="c1"># Hz_1 = ws.Hzgen_1(Ah, m, γ)</span>
<span class="c1"># Hz_2 = ws.Hzgen_2(Bh, m, β)</span>

<span class="c1"># Et1 = ws.Et1gen_1(Ae, Ah, Be, Bh, m, β, γ, kz, λfree)</span>
<span class="c1"># Et2 = ws.Et2gen_1(Ae, Ah, Be, Bh, m, β, γ, kz, λfree)</span>
<span class="c1"># Ht1 = ws.Ht1gen_1(Ae, Ah, Be, Bh, m, β, γ, kz, λfree, nCore)</span>
<span class="c1"># Ht2 = ws.Ht2gen_1(Ae, Ah, Be, Bh, m, β, γ, kz, λfree, nCladding)</span>

<span class="c1"># ρrangein = np.linspace(0, a, 200)</span>
<span class="c1"># ρrangeout = np.linspace(a, b, 50)</span>

<span class="c1"># Ezvals1 = Ez_1(ρrangein)</span>
<span class="c1"># Ezvals2 = Ez_2(ρrangeout)</span>
<span class="c1"># Hzvals1 = Hz_1(ρrangein)</span>
<span class="c1"># Hzvals2 = Hz_2(ρrangeout)</span>

<span class="c1"># fig, ax = plt.subplots(nrows=1,figsize=(10,5))</span>
<span class="c1"># ax.plot(ρrangein, np.real(Ezvals1),&#39;b&#39;, label=&#39;Re(Ez)&#39;)</span>
<span class="c1"># ax.plot(ρrangeout, np.real(Ezvals2),&#39;b&#39;)</span>
<span class="c1"># ax.plot(ρrangein, np.imag(Ezvals1),&#39;r&#39;, label=&#39;Im(Ez)&#39;)</span>
<span class="c1"># ax.plot(ρrangeout, np.imag(Ezvals2),&#39;r&#39;)</span>
<span class="c1"># ax.set_xlabel(&#39;ρ/µm&#39;)</span>
<span class="c1"># ax.set_ylabel(&#39;Hz&#39;)</span>
<span class="c1"># ax.legend()</span>
<span class="c1"># plt.subplots_adjust()</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fieldarray1 = np.imag(Etvals1[0,:,])</span>
<span class="c1"># fieldarray1[X**2 + Y**2 &gt; a**2] = 0</span>
<span class="c1"># fieldarray2 = np.imag(Etvals2[0,:,])</span>
<span class="c1"># fieldarray2[X**2 + Y**2 &lt; a**2] = 0</span>
<span class="c1"># fieldarray_xim = fieldarray1 + fieldarray2</span>

<span class="c1"># fieldarray1 = np.imag(Etvals1[1,:,])</span>
<span class="c1"># fieldarray1[X**2 + Y**2 &gt; a**2] = 0</span>
<span class="c1"># fieldarray2 = np.imag(Etvals2[1,:,])</span>
<span class="c1"># fieldarray2[X**2 + Y**2 &lt; a**2] = 0</span>
<span class="c1"># fieldarray_yim = fieldarray1 + fieldarray2</span>

<span class="c1"># fieldarray1 = np.imag(Etvals1[0,:,])**2 + np.imag(Etvals1[1,:,])**2</span>
<span class="c1"># fieldarray1[X**2 + Y**2 &gt; a**2] = 0</span>
<span class="c1"># fieldarray2 = np.imag(Etvals2[0,:,])**2 + np.imag(Etvals2[1,:,])**2</span>
<span class="c1"># fieldarray2[X**2 + Y**2 &lt; a**2] = 0</span>
<span class="c1"># fieldarray_mag2 = fieldarray1 + fieldarray2</span>

<span class="c1"># plotfields = [fieldarray_xim, fieldarray_yim, fieldarray_mag2]</span>

<span class="c1"># labels = [&#39;Im(Et_x)&#39;, &#39;Im(Et_y)&#39;, &#39;|Et|^2&#39;]</span>

<span class="c1"># fig, axes = plt.subplots(nrows = 1, ncols=3, figsize=(15,5))</span>

<span class="c1"># for idx, (pfield, label) in enumerate(zip(plotfields, labels)):</span>
<span class="c1">#     ax = axes[idx]</span>
<span class="c1">#     if label == &#39;|Et|^2&#39;:</span>
<span class="c1">#         cmap = cm.ember</span>
<span class="c1">#         maxmag2 = np.max(fieldarray_mag2)</span>
<span class="c1">#         iplot = ax.imshow(fieldarray_mag2,</span>
<span class="c1">#                 norm=LogNorm(vmin=maxmag2*1e-3, vmax=maxmag2),</span>
<span class="c1">#                 cmap=cmap,</span>
<span class="c1">#                 extent=[-a*1.5, a*1.5, -a*1.5, a*1.5])</span>
<span class="c1">#     else:</span>
<span class="c1">#         cmap = cm.watermelon</span>
<span class="c1">#         iplot = ax.imshow(pfield,</span>
<span class="c1">#             cmap=cmap,</span>
<span class="c1">#             extent=[-a*1.5, a*1.5, -a*1.5, a*1.5])</span>
<span class="c1">#     ax.set_title(label)</span>
<span class="c1">#     ax.set_xlabel(&#39;x/µm&#39;)</span>
<span class="c1">#     ax.set_ylabel(&#39;y/µm&#39;)</span>
<span class="c1">#     divider = make_axes_locatable(ax)</span>
<span class="c1">#     cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.2)</span>
<span class="c1">#     plt.colorbar(iplot, cax=cax)</span>
<span class="c1"># plt.tight_layout()</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="###Calculating-the-eigenbasis">
<h3>###Calculating the eigenbasis<a class="headerlink" href="####Calculating-the-eigenbasis" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # given a spatial resolution r, calculate an array</span>
<span class="c1"># # that contains the necessary data to decompose a</span>
<span class="c1"># # a given field into a sum of modes.</span>
<span class="c1"># # I will do this in a cartesian coordinate system</span>
<span class="c1"># # although probably doing this in cylindrical coordinates</span>
<span class="c1"># # would be more efficient</span>

<span class="c1"># a = fiber_sol[&#39;coreRadius&#39;]</span>
<span class="c1"># b = a*1.5 # assumed, in reality the cladding is assumed to be infinite</span>
<span class="c1"># nCore = fiber_sol[&#39;nCore&#39;]</span>
<span class="c1"># nCladding = fiber_sol[&#39;nCladding&#39;]</span>
<span class="c1"># λfree = fiber_sol[&#39;free_space_wavelength&#39;]</span>

<span class="c1"># resolution = λfree / nCore / 2</span>
<span class="c1"># # calculate the coordinates arrays</span>
<span class="c1"># numSamples = int(2 * b / resolution)</span>
<span class="c1"># xrange = np.linspace(-b, b, numSamples)</span>
<span class="c1"># yrange = np.linspace(-b, b, numSamples)</span>
<span class="c1"># Xg, Yg = np.meshgrid(xrange, yrange)</span>

<span class="c1"># # determine how many modes there are in total</span>
<span class="c1"># totalModes = sum(list(map(len,fiber_sol[&#39;HEkz&#39;].values())))</span>
<span class="c1"># totalModes += len(fiber_sol[&#39;TMkz&#39;][0])</span>
<span class="c1"># totalModes += len(fiber_sol[&#39;TEkz&#39;][0])</span>


<span class="c1"># eigenbasis = np.zeros((totalModes, 2, 2, numSamples, numSamples), dtype=np.complex64)</span>
<span class="c1"># counter = 0</span>
<span class="c1"># inner_mask = (Xg**2 + Yg**2 &lt;= a**2)</span>
<span class="c1"># outer_mask = (Xg**2 + Yg**2 &gt; a**2)</span>
<span class="c1"># annotations = []</span>

<span class="c1"># for modtype in [&#39;TE&#39;,&#39;TM&#39;,&#39;HE&#39;]:</span>
<span class="c1">#     solkey = modtype + &#39;kz&#39;</span>
<span class="c1">#     for m, kzs in fiber_sol[solkey].items():</span>
<span class="c1">#         for kzidx, kz in enumerate(tqdm(kzs)):</span>
<span class="c1">#             γ = np.sqrt(nCore**2*4*np.pi**2/λfree**2 - kz**2)</span>
<span class="c1">#             β = np.sqrt(kz**2 - nCladding**2*4*np.pi**2/λfree**2)</span>

<span class="c1">#             Ae, Ah, Be, Bh = ws.AeAhBeBh(modtype, a, nCore, nCladding, λfree, m, kz)</span>
<span class="c1">#             Et1 = ws.Et1gen_1(Ae, Ah, Be, Bh, m, β, γ, kz, λfree)</span>
<span class="c1">#             Et2 = ws.Et2gen_1(Ae, Ah, Be, Bh, m, β, γ, kz, λfree)</span>
<span class="c1">#             Ht1 = ws.Ht1gen_1(Ae, Ah, Be, Bh, m, β, γ, kz, λfree, nCore)</span>
<span class="c1">#             Ht2 = ws.Ht2gen_1(Ae, Ah, Be, Bh, m, β, γ, kz, λfree, nCladding)</span>
<span class="c1">#             Etvals1 = Et1(Xg, Yg)</span>
<span class="c1">#             Etvals1[0,outer_mask] = 0</span>
<span class="c1">#             Etvals1[1,outer_mask] = 0</span>
<span class="c1">#             Etvals2 = Et2(Xg, Yg)</span>
<span class="c1">#             Etvals2[0,inner_mask] = 0</span>
<span class="c1">#             Etvals2[1,inner_mask] = 0</span>
<span class="c1">#             Et = Etvals1 + Etvals2</span>
<span class="c1">#             Et[np.isnan(Et)] = 0</span>
<span class="c1">#             Etnorm = np.sum(np.abs(Et[0,::])**2 + np.abs(Et[1,::])**2)</span>
<span class="c1">#             Etnorm = np.sqrt(Etnorm)</span>
<span class="c1">#             Et /= Etnorm</span>
<span class="c1">#             Htvals1 = Ht1(Xg, Yg)</span>
<span class="c1">#             Htvals1[0,outer_mask] = 0</span>
<span class="c1">#             Htvals1[1,outer_mask] = 0</span>
<span class="c1">#             Htvals2 = Ht2(Xg, Yg)</span>
<span class="c1">#             Htvals2[0,inner_mask] = 0</span>
<span class="c1">#             Htvals2[1,inner_mask] = 0</span>
<span class="c1">#             Ht = Htvals1 + Htvals2</span>
<span class="c1">#             Ht[np.isnan(Ht)] = 0</span>
<span class="c1">#             Htnorm = np.sum(np.abs(Ht[0,::])**2 + np.abs(Ht[1,::])**2)</span>
<span class="c1">#             Htnorm = np.sqrt(Htnorm)</span>
<span class="c1">#             Ht /= Htnorm</span>
<span class="c1">#             eigenbasis[counter, 0, :, :, :] = Et</span>
<span class="c1">#             eigenbasis[counter, 1, :, :, :] = Ht</span>
<span class="c1">#             counter += 1</span>
<span class="c1">#             annotationTR = &#39;%s(%d,%d)&#39; % (modtype, m, kzidx)</span>
<span class="c1">#             annotationBR = &#39;kz=%.1f µm⁻¹&#39; % (kz)</span>
<span class="c1">#             annotations.append((annotationTR, annotationBR))</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># aratio = 16/9</span>
<span class="c1"># nrows, ncols = ws.find_layout_rectangle(aratio, totalModes)</span>
<span class="c1"># fig, axes = plt.subplots(nrows=nrows, ncols=ncols, figsize=(15*aratio,15))</span>
<span class="c1"># counter = 0</span>
<span class="c1"># plotkind = &#39;Ex&#39;</span>
<span class="c1"># # plotkind = &#39;|E|^2&#39;</span>
<span class="c1"># cmap = {&#39;Ex&#39;: cm.watermelon, &#39;|E|^2&#39;: cm.ember}[plotkind]</span>
<span class="c1"># for rowidx in range(nrows):</span>
<span class="c1">#     for colidx in range(ncols):</span>
<span class="c1">#         print(rowidx, colidx, end=&#39;\r&#39;)</span>
<span class="c1">#         idx = rowidx * ncols + colidx</span>
<span class="c1">#         axis = axes[rowidx, colidx]</span>
<span class="c1">#         if idx &gt;= totalModes - 1:</span>
<span class="c1">#             axes[rowidx, colidx].set_axis_off()</span>
<span class="c1">#             continue</span>
<span class="c1">#         if plotkind == &#39;Ex&#39;:</span>
<span class="c1">#             plotfield = np.imag(eigenbasis[idx,0,0,:,:])</span>
<span class="c1">#             pfmax = np.max(plotfield)</span>
<span class="c1">#             pfmin = np.min(plotfield)</span>
<span class="c1">#             pfrange = max(pfmax, np.abs(pfmin))</span>
<span class="c1">#             vmax = pfrange</span>
<span class="c1">#             vmin = -pfrange</span>
<span class="c1">#         elif plotkind == &#39;|E|^2&#39;:</span>
<span class="c1">#             plotfield = np.abs(eigenbasis[idx,0,0,:,:])**2 + np.abs(eigenbasis[idx,0,1,:,:])**2</span>
<span class="c1">#             pfmax = np.max(plotfield)</span>
<span class="c1">#             vmax = pfmax</span>
<span class="c1">#             vmin = 0</span>
<span class="c1">#         iplot = axis.imshow(plotfield,</span>
<span class="c1">#                     extent=[-b, b, -b, b],</span>
<span class="c1">#                     origin=&#39;lower&#39;,</span>
<span class="c1">#                     vmin=vmin,</span>
<span class="c1">#                     vmax=vmax,</span>
<span class="c1">#                     cmap=cmap)</span>
<span class="c1">#         axis.text(0.99, 0.99, annotations[counter][0], transform=axis.transAxes, horizontalalignment=&#39;right&#39;, verticalalignment=&#39;top&#39;)</span>
<span class="c1">#         axis.text(0.99, 0.01, annotations[counter][1], transform=axis.transAxes, horizontalalignment=&#39;right&#39;, verticalalignment=&#39;bottom&#39;)</span>
<span class="c1">#         if rowidx == 0 and colidx == 0:</span>
<span class="c1">#             axis.text(0.01, 0.99, plotkind, transform=axis.transAxes, horizontalalignment=&#39;left&#39;, verticalalignment=&#39;top&#39;)</span>
<span class="c1">#         divider = make_axes_locatable(axis)</span>
<span class="c1">#         cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.2)</span>
<span class="c1">#         plt.colorbar(iplot, cax=cax)</span>
<span class="c1">#         if colidx == 0:</span>
<span class="c1">#             axes[rowidx, colidx].set_ylabel(&#39;y/µm&#39;)</span>
<span class="c1">#         if rowidx == nrows - 1:</span>
<span class="c1">#             axes[rowidx, colidx].set_xlabel(&#39;x/µm&#39;)</span>
<span class="c1">#         counter += 1</span>
<span class="c1"># plt.tight_layout()</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="##Fiber-specs-from-Thorlabs">
<h2>##Fiber specs from Thorlabs<a class="headerlink" href="###Fiber-specs-from-Thorlabs" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="s1">&#39;./data/Thorlabs Fibers.xlsx&#39;</span><span class="p">)</span>
<span class="n">attenuation_sheets</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">sheet_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">fiber_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">xl</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">attenuation_sheets</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">fiber</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fiber_data</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fiber</span><span class="p">)</span>
    <span class="n">x</span> <span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">fiber_data</span><span class="p">[</span><span class="n">fiber</span><span class="p">][</span><span class="s1">&#39;λ / nm&#39;</span><span class="p">],</span> <span class="n">fiber_data</span><span class="p">[</span><span class="n">fiber</span><span class="p">][</span><span class="s1">&#39;Attenuation dB / km&#39;</span><span class="p">]</span>
    <span class="n">sorter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">sorter</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">sorter</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">fiber</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;-.&#39;</span><span class="p">][</span><span class="n">idx</span><span class="o">%</span><span class="k">4</span>])
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;λ/nm&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Attenuation / dB/km&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FG010LDA
FG025LJA
FG050LGA - Low OH
FG050LGA - High OH
FG105LVA
FG105LCA - High OH
FG105LCA - Low OH
FG200LEA - High OH
FG200LEA - Low OH
FT200EMT - High OH
FT200EMT - Low OH
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_27_1.png" class="no-scaled-link" src="_images/wavesight-old_27_1.png" style="width: 1201px; height: 604px;" />
</div>
</div>
</section>
<section id="##FG050LGA">
<h2>##FG050LGA<a class="headerlink" href="###FG050LGA" title="Link to this heading">¶</a></h2>
<section id="###Calculate-the-allowed-propagation-constants-kz">
<h3>###Calculate the allowed propagation constants kz<a class="headerlink" href="####Calculate-the-allowed-propagation-constants-kz" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fiber_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;NA&#39;</span><span class="p">:</span> <span class="mf">0.22</span><span class="p">,</span>
              <span class="s1">&#39;nCore&#39;</span><span class="p">:</span> <span class="mf">1.45</span><span class="p">,</span>
              <span class="s1">&#39;coreRadius&#39;</span><span class="p">:</span><span class="mf">25.</span><span class="p">,</span>
              <span class="s1">&#39;grid_divider&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s1">&#39;nFree&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span>
              <span class="s1">&#39;free_space_wavelength&#39;</span><span class="p">:</span> <span class="mf">0.600</span><span class="p">}</span>
<span class="n">fiber_sol</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">multisolver</span><span class="p">(</span><span class="n">fiber_spec</span><span class="p">,</span> <span class="n">drawPlots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
========================================
Approx number of complex HE modes:  800
Approx number of TE modes:  28
Approx number of TM modes:  28
Approx number of total modes:  1658
Approx Max n for HE modes:  40
========================================
Calculting TE(0,n) propagation constants ...
Calculting TM(0,n) propagation constants ...
Calculting HE(m,n) propagation constants ...
m=53
========================================
HE modes = 1590
TE modes = 36
TM modes = 36
TOTAL modes = 1662
FROM_Vnum = 1658
========================================
</pre></div></div>
</div>
</section>
<section id="###Calculate-the-numerical-mode-basis">
<h3>###Calculate the numerical mode basis<a class="headerlink" href="####Calculate-the-numerical-mode-basis" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fiber_sol</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">calculate_numerical_basis</span><span class="p">(</span><span class="n">fiber_sol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "562051e7453c473394470b0b70a2aa4f", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f767275aed404584bd4411a18b615dc8", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "71940b27b5294bc89a21cc492dfee83b", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a62ac5151b3146f7bb78ffe4487d43d9", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "03284fcfd40a4019b7837fc158821a0a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "121fab0735e54951b972be10c943039f", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "329836ce7b6949979adb925c467b8044", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "23d0af3025344b1a9ced9acfadba9072", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0c8f1fee8eae47e88bef7e1b7884f885", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fec2f1ecac584c5494e6fb47e9e827d6", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1e095c0681b946c2a6be8e0bc4e72b42", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "030bcf710d624c30994a4cf7a9344a3b", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c240f94a966b4399b227f9e7589d382f", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4c1a36428c9547719d835e94dd0249cd", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cd4ca53a0cea4cd3aa85efb9c60edc71", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "19e2e60d681446109296d6d2fa94fea7", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f875cb43c06e4924b0b9b61abe462cb9", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c8fc94b19cdb4d75a5a1d0db2dfe079b", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "537d633fa2aa4ff7bf316967da04c70b", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fdeafa61c9234e9a83ef570004dad8b4", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "19b51cd19b5841fe8707727ba2eeff90", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c30f18d83f0b49d9b91c5655dcfc3e6a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ef532a0cc7d04b238b44d543eba0d0d5", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "845eae8e0cf3407885f82de2731e2bd1", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f06f83c8f1604a5aa6e5438903f22f93", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c0032ef6aa0a4ac8855ed6db79bcba30", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2fff3f5a6bfb4e0fafb2510a6c4ec957", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "89690789b22e4a2597b148378ad735f3", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ab2157c31f6e4bf292ff800ad994fbcc", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6d836df05fa04817a7fd83de4737c4f5", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fa46403cb1d14f499cf8d47e5c479d4f", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a92dc2735d4f48ed9a392cdcd5c5fc3c", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9c917454409143c0a4ec200afea5db66", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "038617e250194bd5a409512bde1c195d", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "90e452db8a5d4d289d2e4170280af348", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f4da85f5eee54683884eedc1f187d3d0", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "eb0c1d4c22fe414f927f5691a4c139eb", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "bf414b07c8fb4842a1c8e977c9262b17", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c8860267b5f34129b6873138081d96db", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2ff335d74c0549feb6b2deecdd479ab3", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "86f78ee5fc3f42c89bc99e58edfa98a3", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "34f01c2ecbbc40ad821182b3f0025594", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6c39c47df38947e9934e9902648e7bdc", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ce810dae96fe47f7a479f3448dbceb30", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b78548d1b211468cba460cd9cd632f3e", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "65d36e1645fe4d3fb30c556e8d9e3e9c", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "95de48e1aeb44aacbb8603ba0b6a436a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9767b44277a0481fb0e0bbd32bcf08ba", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3d20dc7e229c4dd1831acbe45a6a8652", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "55749ad83af647f7b4c5ec0565b6f40a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4d019bac7a0b4dd48f9e2c3fe217aa5f", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4b363e9116944f70949ed0059d7648f4", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0ec569bbda7e401a897de5a040595f5d", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "533781eea11d444a8398d021e292343d", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pickle.dump(fiber_sol, open(&#39;eigenbasis-FG050LGA.pkl&#39;, &#39;wb&#39;))</span>
</pre></div>
</div>
</div>
</section>
<section id="###Plot-the-modes">
<h3>###Plot the modes<a class="headerlink" href="####Plot-the-modes" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.axes_divider</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Δs</span><span class="p">,</span> <span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">ρrange</span><span class="p">,</span> <span class="n">φrange</span><span class="p">,</span> <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">ρg</span><span class="p">,</span> <span class="n">φg</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">crossMask</span><span class="p">,</span> <span class="n">numSamples</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coord_layout&#39;</span><span class="p">]</span>
<span class="n">nCore</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCore&#39;</span><span class="p">]</span>
<span class="n">nCladding</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCladding&#39;</span><span class="p">]</span>
<span class="n">λfree</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;free_space_wavelength&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annotations</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">modtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;TM&#39;</span><span class="p">,</span><span class="s1">&#39;HE&#39;</span><span class="p">]:</span>
    <span class="n">solkey</span> <span class="o">=</span> <span class="n">modtype</span> <span class="o">+</span> <span class="s1">&#39;kz&#39;</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">kzs</span> <span class="ow">in</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="n">solkey</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">kzidx</span><span class="p">,</span> <span class="n">kz</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kzs</span><span class="p">):</span>
            <span class="n">γ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nCore</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">kz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">β</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">nCladding</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">annotationTR</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">modtype</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">kzidx</span><span class="p">)</span>
            <span class="n">annotationBR</span> <span class="o">=</span> <span class="s1">&#39;kz=</span><span class="si">%.3f</span><span class="s1"> µm⁻¹&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kz</span><span class="p">)</span>
            <span class="n">annotations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">annotationTR</span><span class="p">,</span> <span class="n">annotationBR</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot one</span>
<span class="k">def</span> <span class="nf">fmt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;0&#39;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.1e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">{}</span><span class="s1"> E{{</span><span class="si">{}</span><span class="s1">}}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;dark_background&#39;</span><span class="p">)</span>
<span class="n">component_index</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Et_ρ&quot;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Et_ϕ&quot;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Ht_ρ&quot;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Ht_ϕ&quot;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)}</span>
<span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
<span class="n">extent</span>  <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>
<span class="k">for</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">]:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">]:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">watermelon</span>
        <span class="k">if</span> <span class="n">fun_picker</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">:</span>
            <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Re{</span><span class="si">%s</span><span class="s1">}&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Im{</span><span class="si">%s</span><span class="s1">}&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ember</span>
        <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;|</span><span class="si">%s</span><span class="s1">|&#39;</span>
    <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">ci</span> <span class="ow">in</span> <span class="n">component_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">field</span>   <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;eigenbasis&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span> <span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">field</span>   <span class="o">=</span> <span class="n">fun_picker</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">fun_picker</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fun_picker</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">:</span>
                <span class="n">fun_picker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span>
                <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Im{</span><span class="si">%s</span><span class="s1">}&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fun_picker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span>
                <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Re{</span><span class="si">%s</span><span class="s1">}&#39;</span>
            <span class="n">field</span>   <span class="o">=</span> <span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">field</span>   <span class="o">=</span> <span class="n">fun_picker</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">]:</span>
            <span class="n">themax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">themax</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">themax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iplot</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">field</span><span class="p">,</span>
                <span class="c1"># vmin=vmin,</span>
                <span class="c1"># vmax=vmax,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmax</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
                <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_format</span> <span class="o">%</span> <span class="n">component</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axis</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axis</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">iplot</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_38_0.png" class="no-scaled-link" src="_images/wavesight-old_38_0.png" style="width: 705px; height: 567px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_38_1.png" class="no-scaled-link" src="_images/wavesight-old_38_1.png" style="width: 705px; height: 567px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot and export all</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;dark_background&#39;</span><span class="p">)</span>
<span class="n">component_index</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Et_ρ&quot;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Et_ϕ&quot;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Ht_ρ&quot;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Ht_ϕ&quot;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)}</span>
<span class="n">extent</span>  <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">totalModes</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">]:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">]:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">watermelon</span>
            <span class="k">if</span> <span class="n">fun_picker</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">:</span>
                <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Re{</span><span class="si">%s</span><span class="s1">}&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Im{</span><span class="si">%s</span><span class="s1">}&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ember</span>
            <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;|</span><span class="si">%s</span><span class="s1">|&#39;</span>
        <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">ci</span> <span class="ow">in</span> <span class="n">component_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">field</span>   <span class="o">=</span> <span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">field</span>   <span class="o">=</span> <span class="n">fun_picker</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">fun_picker</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fun_picker</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">:</span>
                    <span class="n">fun_picker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span>
                    <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Im{</span><span class="si">%s</span><span class="s1">}&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fun_picker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span>
                    <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Re{</span><span class="si">%s</span><span class="s1">}&#39;</span>
                <span class="n">field</span>   <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;eigenbasis&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span> <span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span>
                <span class="n">field</span>   <span class="o">=</span> <span class="n">fun_picker</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">]:</span>
                <span class="n">themax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">themax</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">themax</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">iplot</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">field</span><span class="p">,</span>
                    <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
                    <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                    <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_format</span> <span class="o">%</span> <span class="n">component</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axis</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axis</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
            <span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">iplot</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">]:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;./FG050LGA/reim/mode-</span><span class="si">%d</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="n">index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;./FG050LGA/abs/mode-</span><span class="si">%d</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="n">index</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="###Launching-fields-across-the-end-of-the-waveguide">
<h3>###Launching fields across the end of the waveguide<a class="headerlink" href="####Launching-fields-across-the-end-of-the-waveguide" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">totalModes</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;totalModes&#39;</span><span class="p">]</span>
<span class="n">λfree</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;free_space_wavelength&#39;</span><span class="p">]</span>
<span class="n">eigenbasis</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;eigenbasis&#39;</span><span class="p">]</span>
<span class="n">nCore</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCore&#39;</span><span class="p">]</span>
<span class="n">nCladding</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCladding&#39;</span><span class="p">]</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Δs</span><span class="p">,</span> <span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">ρrange</span><span class="p">,</span> <span class="n">φrange</span><span class="p">,</span> <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">ρg</span><span class="p">,</span> <span class="n">φg</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">crossMask</span><span class="p">,</span> <span class="n">numSamples</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coord_layout&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annotations</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">modtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;TE&#39;</span><span class="p">,</span><span class="s1">&#39;TM&#39;</span><span class="p">,</span><span class="s1">&#39;HE&#39;</span><span class="p">]:</span>
    <span class="n">solkey</span> <span class="o">=</span> <span class="n">modtype</span> <span class="o">+</span> <span class="s1">&#39;kz&#39;</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">kzs</span> <span class="ow">in</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="n">solkey</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">kzidx</span><span class="p">,</span> <span class="n">kz</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kzs</span><span class="p">):</span>
            <span class="n">γ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nCore</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">kz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">β</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">nCladding</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">λfree</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">annotationTR</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">modtype</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">kzidx</span><span class="p">)</span>
            <span class="n">annotationBR</span> <span class="o">=</span> <span class="s1">&#39;kz=</span><span class="si">%.3f</span><span class="s1"> µm⁻¹&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kz</span><span class="p">)</span>
            <span class="n">annotations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">annotationTR</span><span class="p">,</span> <span class="n">annotationBR</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">indexPercent</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">indexPercent</span> <span class="o">*</span> <span class="n">totalModes</span><span class="p">)</span>
<span class="n">nFree</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">annot</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="c1"># pick the E and H fields</span>
<span class="n">Einc</span> <span class="o">=</span> <span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">Hinc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:])</span>
<span class="n">kref</span><span class="p">,</span> <span class="n">Eref</span><span class="p">,</span> <span class="n">Href</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">poyntingrefractor</span><span class="p">(</span><span class="n">Einc</span><span class="p">,</span> <span class="n">Hinc</span><span class="p">,</span> <span class="n">nFree</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Calculating the Poynting vector field...
Calculating the magnitude of the Poynting field...
Calculating the transverse component of the Poynting field...
Calculating the unit vector in the direction of the Poynting vector...
Calculating the angle of incidence field...
Calculating the angle of refraction field...
Calculating the Fresnel coefficients...
Calculating the ζ of the local coord system...
Calculating the S and P component of the incident electric field...
Calculating the S and P component of the refracted electric field...
Calculating the total refracted electric field...
Calculating the refracted wavevector (normalized) field...
Calculating the refracted H field...
</pre></div></div>
</div>
<section id="####Spaguetti-code">
<h4>####Spaguetti code<a class="headerlink" href="#####Spaguetti-code" title="Link to this heading">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># given a field (Ex, Ey, Ez) at a plane calculate the discrete</span>
<span class="c1"># fourier transform of the field in the x,y,z directions</span>
<span class="c1"># this would provide the field in the frequency domain</span>
<span class="c1"># the field is assumed to be periodic in the x,y,z directions</span>
<span class="n">fiberfield_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">eigenbasis</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:,:])</span>
<span class="c1"># at the moment I haven&#39;t calculate the z component of the field</span>
<span class="c1"># let me just assume a z component that is roughly of the same magnitude</span>
<span class="c1"># of the x and y components, that starts normal at the center and</span>
<span class="c1"># deviates to the NA of the fiber at the edge of it</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ex</span> <span class="o">=</span> <span class="n">fiberfield_t</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span>
<span class="n">Ey</span> <span class="o">=</span> <span class="n">fiberfield_t</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:]</span>
<span class="n">NA</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;NA&#39;</span><span class="p">]</span>
<span class="n">nCore</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCore&#39;</span><span class="p">]</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coreRadius&#39;</span><span class="p">]</span>
<span class="n">thetamax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">NA</span><span class="o">/</span><span class="n">nCore</span><span class="p">)</span>
<span class="c1"># calculate the magnitude of the transverse field</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Xg</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Yg</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># calculate the angle of E at each point</span>
<span class="n">launchAngle</span> <span class="o">=</span> <span class="n">thetamax</span><span class="o">/</span><span class="n">a</span> <span class="o">*</span> <span class="n">r</span>
<span class="c1"># knowing the angle at each position I should be able to &quot;calculate&quot;</span>
<span class="c1"># the z component of the field</span>
<span class="c1"># this doesn&#39;t make any sense, the direction of the</span>
<span class="c1"># electric field is not the direction of the wave vector</span>
<span class="c1"># ok, instead let me estimate the direction of the wave vector</span>
<span class="c1"># across the fiber and then use that together with the field at</span>
<span class="c1"># each position to determine what is a compatible value for the z component</span>
<span class="n">kmag</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">λfree</span><span class="o">*</span><span class="n">nCore</span>
<span class="n">dirfield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Yg</span><span class="p">,</span> <span class="n">Xg</span><span class="p">)</span>
<span class="n">xhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dirfield</span><span class="p">)</span>
<span class="n">yhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dirfield</span><span class="p">)</span>
<span class="n">kz</span> <span class="o">=</span> <span class="n">kmag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span>
<span class="n">kx</span> <span class="o">=</span> <span class="n">kmag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span> <span class="o">*</span> <span class="n">xhat</span>
<span class="n">ky</span> <span class="o">=</span> <span class="n">kmag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span> <span class="o">*</span> <span class="n">yhat</span>
<span class="c1"># at every point</span>
<span class="c1"># now let me make</span>
<span class="c1"># use this to calculate a possible z component for E</span>
<span class="n">dotEk</span> <span class="o">=</span> <span class="n">fiberfield_t</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span> <span class="o">*</span> <span class="n">kx</span> <span class="o">+</span> <span class="n">fiberfield_t</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="o">*</span> <span class="n">ky</span>
<span class="n">Ez</span> <span class="o">=</span> <span class="o">-</span><span class="n">dotEk</span><span class="o">/</span><span class="n">kz</span>
<span class="c1"># in this construction the electric field is always in parallel to the plane of incidence</span>
<span class="n">fresnel</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">nCore</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span>
           <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span> <span class="o">+</span> <span class="n">nCore</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">nCore</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">Erefracted_x</span> <span class="o">=</span> <span class="n">fresnel</span> <span class="o">*</span> <span class="n">Ex</span>
<span class="n">Erefracted_y</span> <span class="o">=</span> <span class="n">fresnel</span> <span class="o">*</span> <span class="n">Ey</span>
<span class="n">Erefracted_z</span> <span class="o">=</span> <span class="n">fresnel</span> <span class="o">*</span> <span class="n">Ez</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Erefracted_x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_47_0.png" src="_images/wavesight-old_47_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ok, next part</span>
<span class="c1"># i need to find the farfield for the refracted field</span>
<span class="c1"># i think I have</span>
<span class="n">apertureRadius</span> <span class="o">=</span> <span class="n">b</span>
<span class="n">λ</span> <span class="o">=</span> <span class="n">λfree</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">λ</span>
<span class="n">replicas</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dist_to_ML</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="n">dist_to_ML</span> <span class="o">*</span> <span class="mi">5</span>
<span class="n">farfield_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">zmax</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">apertureRadius</span> <span class="c1"># spatial extent of the field</span>
<span class="n">field</span> <span class="o">=</span> <span class="n">Erefracted_x</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">idx_width</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">if</span> <span class="n">replicas</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">nearfourier</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">field</span><span class="p">,(</span><span class="n">idx_width</span><span class="p">,</span> <span class="n">idx_width</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">field</span>
<span class="n">kx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="o">=</span><span class="n">dx</span><span class="p">))</span>
<span class="n">ky</span> <span class="o">=</span> <span class="n">kx</span>
<span class="n">kx</span><span class="p">,</span> <span class="n">ky</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">)</span>
<span class="n">kz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">kx</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">ky</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span><span class="p">)</span>

<span class="n">gator</span> <span class="o">=</span> <span class="mf">1.</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">farfield_axis</span><span class="p">,</span> <span class="n">kz</span><span class="p">)</span>
<span class="n">gator</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">*</span><span class="n">farfield_axis</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">*</span><span class="n">kz</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">gator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">gator</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">NA</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">180</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
12.709032994395436
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gator</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(100, 362, 362)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cmasher</span> <span class="k">as</span> <span class="nn">cmr</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">farfields</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ex&#39;</span><span class="p">:</span><span class="n">Erefracted_x</span><span class="p">,</span> <span class="s1">&#39;ey&#39;</span><span class="p">:</span><span class="n">Erefracted_y</span><span class="p">}</span>
<span class="k">for</span> <span class="n">field_component</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span><span class="s1">&#39;ey&#39;</span><span class="p">]:</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">field_component</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">idx_width</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">field</span>
    <span class="c1"># calculate the Fourier transform of the nearfield</span>
    <span class="n">nearfourier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
    <span class="c1"># multiply by the farfield propagator</span>
    <span class="n">farfourier</span> <span class="o">=</span> <span class="n">nearfourier</span> <span class="o">*</span> <span class="n">gator</span>
    <span class="c1"># calculate the inverse Fourier transform</span>
    <span class="n">farfield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft2</span><span class="p">(</span><span class="n">farfourier</span><span class="p">)</span>

    <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">replicas</span><span class="p">,</span> <span class="n">L</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">replicas</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zmax</span><span class="p">]</span>
    <span class="c1"># get the field on the zx plane</span>
    <span class="n">pfield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">farfield</span><span class="p">[::,</span><span class="n">farfield</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">farfields</span><span class="p">[</span><span class="n">field_component</span><span class="p">]</span> <span class="o">=</span> <span class="n">pfield</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pfield</span><span class="p">,</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmr</span><span class="o">.</span><span class="n">ember</span><span class="p">,</span>
            <span class="n">extent</span> <span class="o">=</span> <span class="n">extent</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x/$\mu$m&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;z/$\mu$m&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;|</span><span class="si">%s</span><span class="s1">|^2&#39;</span> <span class="o">%</span> <span class="n">field_component</span><span class="p">)</span>
<span class="c1">#     plt.colorbar()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_52_0.png" src="_images/wavesight-old_52_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_52_1.png" src="_images/wavesight-old_52_1.png" />
</div>
</div>
</section>
</section>
<section id="###Poynting-vectors-and-angles-of-incidence">
<h3>###Poynting vectors and angles of incidence<a class="headerlink" href="####Poynting-vectors-and-angles-of-incidence" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;dark_background&#39;</span><span class="p">)</span>
<span class="n">component_index</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Et_ρ&quot;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Et_ϕ&quot;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Ht_ρ&quot;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Ht_ϕ&quot;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)}</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">extent</span>  <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>
<span class="k">for</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">]:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">]:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">watermelon</span>
        <span class="k">if</span> <span class="n">fun_picker</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">:</span>
            <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Re{</span><span class="si">%s</span><span class="s1">}&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Im{</span><span class="si">%s</span><span class="s1">}&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ember</span>
        <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;|</span><span class="si">%s</span><span class="s1">|&#39;</span>
    <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">ci</span> <span class="ow">in</span> <span class="n">component_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">field</span>   <span class="o">=</span> <span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">field</span>   <span class="o">=</span> <span class="n">fun_picker</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">fun_picker</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fun_picker</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">:</span>
                <span class="n">fun_picker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span>
                <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Im{</span><span class="si">%s</span><span class="s1">}&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fun_picker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span>
                <span class="n">title_format</span> <span class="o">=</span> <span class="s1">&#39;Re{</span><span class="si">%s</span><span class="s1">}&#39;</span>
            <span class="n">field</span>   <span class="o">=</span> <span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">field</span>   <span class="o">=</span> <span class="n">fun_picker</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">fun_picker</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">]:</span>
            <span class="n">themax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">themax</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">themax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iplot</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">field</span><span class="p">,</span>
                <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
                <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_format</span> <span class="o">%</span> <span class="n">component</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axis</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axis</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">iplot</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_54_0.png" class="no-scaled-link" src="_images/wavesight-old_54_0.png" style="width: 713px; height: 567px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_54_1.png" class="no-scaled-link" src="_images/wavesight-old_54_1.png" style="width: 713px; height: 567px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># coord_layout = coordinate_layout(fiber_sol)</span>
<span class="c1"># a, b, Δs, xrange, yrange, ρrange, φrange, Xg, Yg, ρg, φg, nxy, crossMask = coord_layout</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # get a mode</span>
<span class="c1"># index = 30</span>
<span class="c1"># Efield = eigenbasis[index, 0, :, :, :]</span>
<span class="c1"># Hfield = np.conjugate(eigenbasis[index, 1, :, :, :])</span>

<span class="c1"># # #EXH-Calc</span>
<span class="c1"># Sfield = 0.5*np.real(np.cross(Efield, Hfield, axis=0))</span>

<span class="c1"># # #normIncident-Calc</span>
<span class="c1"># Sfieldmag = np.sqrt(Sfield[0,:,:]**2 + Sfield[1,:,:]**2 + Sfield[2,:,:]**2)</span>
<span class="c1"># Stransverse = np.sqrt(Sfield[0,:,:]**2 + Sfield[1,:,:]**2)</span>
<span class="c1"># dirField = np.arctan2(Stransverse,</span>
<span class="c1">#                       Sfield[2, :, :])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">implot</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dirField</span><span class="p">,</span>
           <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
           <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">ember</span><span class="p">)</span>
<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;|β|&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">implot</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
<span class="n">implot</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Sfieldmag</span><span class="p">,</span>
           <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
           <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">ember</span><span class="p">)</span>
<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;|S|&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">implot</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midindex</span> <span class="o">=</span> <span class="n">dirField</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span>
<span class="n">diameter</span> <span class="o">=</span> <span class="n">dirField</span><span class="p">[</span><span class="n">midindex</span><span class="p">]</span>
<span class="n">ρfull</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">dirField</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ρfull</span><span class="p">,</span> <span class="n">diameter</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;β/°&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_58_0.png" class="no-scaled-link" src="_images/wavesight-old_58_0.png" style="width: 717px; height: 261px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
<span class="n">Efield</span> <span class="o">=</span> <span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">Hfield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Efield</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Efield</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Efield</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9999999
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dotprod</span> <span class="o">=</span> <span class="p">(</span><span class="n">Efield</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">Hfield</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">Efield</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">Hfield</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">Efield</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">Hfield</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">dotprod</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Efield</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Hfield</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">dotangle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dotprod</span><span class="p">))</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dotangle</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_61_0.png" class="no-scaled-link" src="_images/wavesight-old_61_0.png" style="width: 307px; height: 248px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Efield = eigenbasis[index, 0, :, :, :]</span>
<span class="c1"># Hfield = np.conjugate(eigenbasis[index, 1, :, :, :])</span>
<span class="c1"># Sfield = 0.5*np.real(np.cross(Efield, Hfield, axis=0))</span>
<span class="c1"># Sfieldmag = np.sqrt(Sfield[0,:,:]**2 + Sfield[1,:,:]**2 + Sfield[2,:,:]**2)</span>
<span class="c1"># Stransverse = np.sqrt(Sfield[0,:,:]**2 + Sfield[1,:,:]**2)</span>
<span class="c1"># dirField = np.arctan2(Stransverse,</span>
<span class="c1">#                       Sfield[2, :, :])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[418]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Δs</span><span class="p">,</span> <span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">ρrange</span><span class="p">,</span> <span class="n">φrange</span><span class="p">,</span> <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">ρg</span><span class="p">,</span> <span class="n">φg</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">crossMask</span><span class="p">,</span> <span class="n">numSamples</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coord_layout&#39;</span><span class="p">]</span>
<span class="n">eigenbasis</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;eigenbasis&#39;</span><span class="p">]</span>
<span class="n">totalModes</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;totalModes&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[136]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">βfield</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">180</span><span class="p">,</span>
          <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">ember</span><span class="p">,</span>
          <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;β_incident / º -- &#39;</span> <span class="o">+</span> <span class="n">annot</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">θfield</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">180</span><span class="p">,</span>
          <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">ember</span><span class="p">,</span>
          <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/µm&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;θ_refracted / º -- &#39;</span> <span class="o">+</span> <span class="n">annot</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_64_0.png" class="no-scaled-link" src="_images/wavesight-old_64_0.png" style="width: 609px; height: 1147px;" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[285]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get a mode</span>
<span class="n">indexPercent</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">indexPercent</span> <span class="o">*</span> <span class="n">totalModes</span><span class="p">)</span>
<span class="n">nFree</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">annot</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="c1"># pick the E and H fields</span>
<span class="n">Efield</span> <span class="o">=</span> <span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">Hfield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:])</span>

<span class="c1"># #EXH-Calc</span>
<span class="c1"># calculate the Poynting vector</span>
<span class="n">Sfield</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">Efield</span><span class="p">,</span> <span class="n">Hfield</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>


<span class="c1"># #normIncidentk-Calc</span>
<span class="c1"># calculate the magnitude of the Poynting field</span>
<span class="n">Sfieldmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Sfield</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="c1"># calculate the transverse component of the Poynting vector</span>
<span class="n">Stransverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Sfield</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Sfield</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># calculate the direction of the Poynting vector use that to estimate angles of incidence</span>
<span class="c1"># here it&#39;s assumed that the normal is pointing in the +z direction</span>
<span class="c1"># #β-Calc</span>
<span class="n">βfield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Stransverse</span><span class="p">,</span> <span class="n">Sfield</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
<span class="c1"># #θ-Calc</span>
<span class="n">θfield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">nxy</span><span class="o">/</span><span class="n">nFree</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">βfield</span><span class="p">))</span>
<span class="c1"># calculate the unit vector in the direction of the Poynting vector</span>
<span class="n">kfield</span> <span class="o">=</span> <span class="n">Sfield</span> <span class="o">/</span> <span class="n">Sfieldmag</span>
<span class="n">numNans_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">kfield</span><span class="p">))</span>
<span class="n">numNans_β</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">βfield</span><span class="p">))</span>
<span class="n">numNans_θ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">θfield</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;kfield has </span><span class="si">{}</span><span class="s2"> NaNs&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numNans_k</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;βfield has </span><span class="si">{}</span><span class="s2"> NaNs&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numNans_β</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;θfield has </span><span class="si">{}</span><span class="s2"> NaNs&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numNans_θ</span><span class="p">))</span>

<span class="c1"># #FresnelS-Calc</span>
<span class="c1"># #FresnelP-Calc</span>
<span class="c1"># These I can calculate using the refractive indices and the angles of incidence</span>
<span class="c1"># S is perpendicular to plane of incidence</span>
<span class="n">fresnelS</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">nxy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">βfield</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span> <span class="n">nxy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">βfield</span><span class="p">)</span>
               <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nFree</span><span class="o">**</span><span class="mi">2</span>
                               <span class="o">-</span> <span class="n">nxy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">βfield</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
<span class="n">fresnelP</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">nFree</span> <span class="o">*</span> <span class="n">nxy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">βfield</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">nFree</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">βfield</span><span class="p">)</span>
               <span class="o">+</span>  <span class="n">nxy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nFree</span><span class="o">**</span><span class="mi">2</span>
                          <span class="o">-</span> <span class="n">nxy</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">βfield</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>


<span class="c1"># #ζ-Calc</span>
<span class="c1"># calculate the unit vector field perpendicular to the plane of incidence</span>
<span class="c1"># which is basically k X z</span>
<span class="n">ζfield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">kfield</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ζfield</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kfield</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ζfield</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kfield</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># normalize the ζfield</span>
<span class="n">ζfield</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ζfield</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># decompose the field in P and S polarizations</span>
<span class="c1"># first find P-pol and then use the complement to determine S-pol</span>
<span class="c1"># the S-pol can be obtained by the dot product of E with ζ</span>
<span class="c1">#EincS-Calc</span>
<span class="n">ESdot</span> <span class="o">=</span> <span class="n">Efield</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span> <span class="o">*</span> <span class="n">ζfield</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Efield</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="o">*</span> <span class="n">ζfield</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">EincS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ζfield</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">EincS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ESdot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ζfield</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">EincS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ESdot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ζfield</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1">#EincP-Calc</span>
<span class="n">EincP</span> <span class="o">=</span> <span class="n">Efield</span> <span class="o">-</span> <span class="n">EincS</span>
<span class="k">del</span> <span class="n">ESdot</span>

<span class="c1">#ErefS-Calc</span>
<span class="n">ErefS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Efield</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ErefS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fresnelS</span> <span class="o">*</span> <span class="n">EincS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ErefS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fresnelS</span> <span class="o">*</span> <span class="n">EincS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ErefS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">fresnelS</span> <span class="o">*</span> <span class="n">EincS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="c1">#ErefP-Calc</span>
<span class="n">ErefP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Efield</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ErefP</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fresnelP</span> <span class="o">*</span> <span class="n">EincP</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ErefP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fresnelP</span> <span class="o">*</span> <span class="n">EincP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ErefP</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">fresnelP</span> <span class="o">*</span> <span class="n">EincP</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="c1">#Eref-Calc</span>
<span class="n">Eref</span>  <span class="o">=</span> <span class="n">ErefS</span> <span class="o">+</span> <span class="n">ErefP</span>

<span class="c1">#kref-Calc</span>
<span class="n">ξfield</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ζfield</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ξfield</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">ζfield</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ξfield</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ζfield</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">kref</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">kfield</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">kref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">θfield</span><span class="p">)</span> <span class="o">*</span> <span class="n">ξfield</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">kref</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">θfield</span><span class="p">)</span> <span class="o">*</span> <span class="n">ξfield</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">kref</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">θfield</span><span class="p">)</span>

<span class="c1">#Href-Calc</span>
<span class="n">Href</span> <span class="o">=</span> <span class="n">nFree</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">kref</span><span class="p">,</span> <span class="n">Eref</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
kfield has 3 NaNs
βfield has 0 NaNs
θfield has 472 NaNs
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[286]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># def poyntingrefractor(Efield, Hfield, nxy, nFree, verbose=False):</span>
<span class="c1">#     &#39;&#39;&#39;</span>
<span class="c1">#     Approximate the refracted field across a planar   interface</span>
<span class="c1">#     using the Poynting vector as an analog to the wavevector of</span>
<span class="c1">#     a plane-wave.</span>

<span class="c1">#     Parameters</span>
<span class="c1">#     ----------</span>
<span class="c1">#     Efield : np.array (3, N, M)</span>
<span class="c1">#         The electric field incident on the interface.</span>
<span class="c1">#     Hfield : np.array (3, N, M)</span>
<span class="c1">#         The H-field incident on the interface.</span>
<span class="c1">#     nxy : np.array    (N, M)</span>
<span class="c1">#         The refractive index transverse to the interface inside the incident medium.</span>
<span class="c1">#     nFree : float</span>
<span class="c1">#         The refractive index of the homogeneous refractive medium.</span>
<span class="c1">#     verbose : bool, optional</span>
<span class="c1">#         Whether to print or not progress messages, by default False.</span>
<span class="c1">#     &#39;&#39;&#39;</span>
<span class="c1">#     # #EXH-Calc</span>
<span class="c1">#     # calculate the Poynting vector</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the Poynting vector field...&quot;)</span>
<span class="c1">#     Sfield = 0.5*np.real(np.cross(Efield, Hfield, axis=0))</span>

<span class="c1">#     # #normIncidentk-Calc</span>
<span class="c1">#     # calculate the magnitude of the Poynting field</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the magnitude of the Poynting field...&quot;)</span>
<span class="c1">#     Sfieldmag = np.sqrt(np.sum(Sfield**2, axis=0))</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the transverse component of the Poynting field...&quot;)</span>
<span class="c1">#     # calculate the unit vector in the direction of the Poynting vector</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the unit vector in the direction of the Poynting vector...&quot;)</span>
<span class="c1">#     kfield = Sfield / Sfieldmag</span>
<span class="c1">#     # calculate the transverse component of the Poynting vector</span>
<span class="c1">#     Stransverse = np.sqrt(Sfield[0,:,:]**2 + Sfield[1,:,:]**2)</span>

<span class="c1">#     # #β-Calc</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the angle of incidence field...&quot;)</span>
<span class="c1">#     # Assuming that the normal is pointing in the +z direction</span>
<span class="c1">#     βfield = np.arctan2(Stransverse, Sfield[2, :, :])</span>

<span class="c1">#     # #θ-Calc</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the angle of refraction field...&quot;)</span>
<span class="c1">#     θfield = np.arcsin(nxy/nFree * np.sin(βfield))</span>

<span class="c1">#     # #FresnelS-Calc</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the Fresnel coefficients...&quot;)</span>

<span class="c1">#     fresnelS = (2 * nxy * np.cos(βfield)</span>
<span class="c1">#                 / ( nxy * np.cos(βfield)</span>
<span class="c1">#                 + np.sqrt(nFree**2</span>
<span class="c1">#                                 - nxy**2 * np.sin(βfield)**2)</span>
<span class="c1">#                     )</span>
<span class="c1">#                 )</span>

<span class="c1">#     # #FresnelP-Calc</span>
<span class="c1">#     fresnelP = (2 * nFree * nxy * np.cos(βfield)</span>
<span class="c1">#                 / (nFree**2 * np.cos(βfield)</span>
<span class="c1">#                 +  nxy * np.sqrt(nFree**2</span>
<span class="c1">#                             - nxy**2 * np.sin(βfield)**2)</span>
<span class="c1">#                     )</span>
<span class="c1">#                 )</span>

<span class="c1">#     # #ζ-Calc</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the ζ of the local coord system...&quot;)</span>
<span class="c1">#     # calculate the unit vector field perpendicular to the plane of incidence</span>
<span class="c1">#     # which is basically k X z</span>
<span class="c1">#     ζfield = np.zeros(kfield.shape)</span>
<span class="c1">#     ζfield[0] = kfield[1]</span>
<span class="c1">#     ζfield[1] = -kfield[0]</span>
<span class="c1">#     # normalize it</span>
<span class="c1">#     ζfield /= np.sqrt(np.sum(np.abs(ζfield)**2, axis=0))</span>

<span class="c1">#     # #EincS-Calc</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the S and P component of the incident electric field...&quot;)</span>
<span class="c1">#     # decompose the field in P and S polarizations</span>
<span class="c1">#     # first find P-pol and then use the complement to determine S-pol</span>
<span class="c1">#     # the S-pol can be obtained by the dot product of E with ζ</span>
<span class="c1">#     ESdot = Efield[0,:,:] * ζfield[0] + Efield[1,:,:] * ζfield[1]</span>
<span class="c1">#     EincS = np.zeros(ζfield.shape)</span>
<span class="c1">#     EincS[0] = ESdot[0] * ζfield[0]</span>
<span class="c1">#     EincS[1] = ESdot[1] * ζfield[1]</span>
<span class="c1">#     # #EincP-Calc</span>
<span class="c1">#     EincP = Efield - EincS</span>
<span class="c1">#     del ESdot</span>

<span class="c1">#     # #ErefS-Calc</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the S and P component of the refracted electric field...&quot;)</span>
<span class="c1">#     ErefS = np.zeros(Efield.shape)</span>
<span class="c1">#     ErefS[0] = fresnelS * EincS[0]</span>
<span class="c1">#     ErefS[1] = fresnelS * EincS[1]</span>
<span class="c1">#     ErefS[2] = fresnelS * EincS[2]</span>
<span class="c1">#     # #ErefP-Calc</span>
<span class="c1">#     ErefP = np.zeros(Efield.shape)</span>
<span class="c1">#     ErefP[0] = fresnelP * EincP[0]</span>
<span class="c1">#     ErefP[1] = fresnelP * EincP[1]</span>
<span class="c1">#     ErefP[2] = fresnelP * EincP[2]</span>
<span class="c1">#     # #Eref-Calc</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the total refracted electric field...&quot;)</span>
<span class="c1">#     Eref  = ErefS + ErefP</span>

<span class="c1">#     # #kref-Calc</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the refracted wavevector (normalized) field...&quot;)</span>
<span class="c1">#     ξfield    = np.zeros(ζfield.shape)</span>
<span class="c1">#     ξfield[0] = -ζfield[1]</span>
<span class="c1">#     ξfield[1] = ζfield[0]</span>
<span class="c1">#     kref      = np.zeros(kfield.shape)</span>
<span class="c1">#     kref[0]   = np.sin(θfield) * ξfield[0]</span>
<span class="c1">#     kref[1]   = np.sin(θfield) * ξfield[1]</span>
<span class="c1">#     kref[2]   = np.cos(θfield)</span>

<span class="c1">#     # #Href-Calc</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(&quot;Calculating the refracted H field...&quot;)</span>
<span class="c1">#     Href = nFree * np.cross(kref, Eref, axis=0)</span>

<span class="c1">#     return Eref, Href</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[419]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">indexPercent</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">indexPercent</span> <span class="o">*</span> <span class="n">totalModes</span><span class="p">)</span>
<span class="n">nFree</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">annot</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="c1"># pick the E and H fields</span>
<span class="n">Einc</span> <span class="o">=</span> <span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">Hinc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">eigenbasis</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:])</span>
<span class="n">kref</span><span class="p">,</span> <span class="n">Eref</span><span class="p">,</span> <span class="n">Href</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">poyntingrefractor</span><span class="p">(</span><span class="n">Einc</span><span class="p">,</span> <span class="n">Hinc</span><span class="p">,</span> <span class="n">nFree</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Calculating the Poynting vector field...
Calculating the magnitude of the Poynting field...
Calculating the transverse component of the Poynting field...
Calculating the unit vector in the direction of the Poynting vector...
Calculating the angle of incidence field...
Calculating the angle of refraction field...
Calculating the Fresnel coefficients...
Calculating the ζ of the local coord system...
Calculating the S and P component of the incident electric field...
Calculating the S and P component of the refracted electric field...
Calculating the total refracted electric field...
Calculating the refracted wavevector (normalized) field...
Calculating the refracted H field...
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[417]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate the refraction of a plane wave</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">nwg</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">nxy</span> <span class="o">=</span> <span class="n">nwg</span>  <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">))</span>
<span class="n">nFree</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">Efield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">))</span>
<span class="n">γ</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">Efield</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Efield</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">γ</span><span class="p">)</span>
<span class="n">Efield</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">γ</span><span class="p">)</span>
<span class="n">kinc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">γ</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">γ</span><span class="p">)])</span>
<span class="n">Hfield</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">kinc</span><span class="p">,</span> <span class="n">Efield</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">kref</span><span class="p">,</span> <span class="n">Eref</span><span class="p">,</span> <span class="n">Href</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">poyntingrefractor</span><span class="p">(</span><span class="n">Efield</span><span class="p">,</span> <span class="n">Hfield</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">nFree</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">kref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kref</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">kref</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Calculating the Poynting vector field...
Calculating the magnitude of the Poynting field...
Calculating the transverse component of the Poynting field...
Calculating the unit vector in the direction of the Poynting vector...
Calculating the angle of incidence field...
Calculating the angle of refraction field...
Calculating the Fresnel coefficients...
Calculating the ζ of the local coord system...
Calculating the S and P component of the incident electric field...
Calculating the S and P component of the refracted electric field...
Calculating the total refracted electric field...
Calculating the refracted wavevector (normalized) field...
Calculating the refracted H field...
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[411]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">kref</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">kref</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">kinc</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">kinc</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_69_0.png" class="no-scaled-link" src="_images/wavesight-old_69_0.png" style="width: 380px; height: 248px;" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[344]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dim = 500</span>
<span class="c1"># nxy = 1.5 * np.ones((dim, dim))</span>
<span class="c1"># Efield = np.zeros((3, dim, dim))</span>
<span class="c1"># Efield[0] = 1</span>
<span class="c1"># Efield[1] = 0</span>
<span class="c1"># Efield[2] = 0</span>
<span class="c1"># kinc = np.array([0,0,1])</span>
<span class="c1"># Hfield = np.cross(kinc, Efield, axis=0)</span>

<span class="c1"># # #EXH-Calc</span>
<span class="c1"># # calculate the Poynting vector</span>
<span class="c1"># Sfield = 0.5*np.real(np.cross(Efield, Hfield, axis=0))</span>


<span class="c1"># # #normIncidentk-Calc</span>
<span class="c1"># # calculate the magnitude of the Poynting field</span>
<span class="c1"># Sfieldmag = np.sqrt(np.sum(Sfield**2, axis=0))</span>
<span class="c1"># # calculate the transverse component of the Poynting vector</span>
<span class="c1"># Stransverse = np.sqrt(Sfield[0,:,:]**2 + Sfield[1,:,:]**2)</span>
<span class="c1"># # calculate the direction of the Poynting vector use that to estimate angles of incidence</span>
<span class="c1"># # here it&#39;s assumed that the normal is pointing in the +z direction</span>
<span class="c1"># # #β-Calc</span>
<span class="c1"># βfield = np.arctan2(Stransverse, Sfield[2, :, :])</span>
<span class="c1"># # #θ-Calc</span>
<span class="c1"># θfield = np.arcsin(nxy/nFree * np.sin(βfield))</span>
<span class="c1"># # calculate the unit vector in the direction of the Poynting vector</span>
<span class="c1"># kfield = Sfield / Sfieldmag</span>
<span class="c1"># numNans_k = np.sum(np.isnan(kfield))</span>
<span class="c1"># numNans_β = np.sum(np.isnan(βfield))</span>
<span class="c1"># numNans_θ = np.sum(np.isnan(θfield))</span>
<span class="c1"># print(&quot;kfield has {} NaNs&quot;.format(numNans_k))</span>
<span class="c1"># print(&quot;βfield has {} NaNs&quot;.format(numNans_β))</span>
<span class="c1"># print(&quot;θfield has {} NaNs&quot;.format(numNans_θ))</span>

<span class="c1"># # #FresnelS-Calc</span>
<span class="c1"># # #FresnelP-Calc</span>
<span class="c1"># # These I can calculate using the refractive indices and the angles of incidence</span>
<span class="c1"># # S is perpendicular to plane of incidence</span>
<span class="c1"># fresnelS = (2 * nxy * np.cos(βfield)</span>
<span class="c1">#             / ( nxy * np.cos(βfield)</span>
<span class="c1">#                + np.sqrt(nFree**2</span>
<span class="c1">#                                - nxy**2 * np.sin(βfield)**2)</span>
<span class="c1">#                 )</span>
<span class="c1">#             )</span>
<span class="c1"># fresnelP = (2 * nFree * nxy * np.cos(βfield)</span>
<span class="c1">#             / (nFree**2 * np.cos(βfield)</span>
<span class="c1">#                +  nxy * np.sqrt(nFree**2</span>
<span class="c1">#                           - nxy**2 * np.sin(βfield)**2)</span>
<span class="c1">#                 )</span>
<span class="c1">#             )</span>


<span class="c1"># # #ζ-Calc</span>
<span class="c1"># # calculate the unit vector field perpendicular to the plane of incidence</span>
<span class="c1"># # which is basically k X z</span>
<span class="c1"># ζfield = np.zeros(kfield.shape)</span>
<span class="c1"># ζfield[0] = kfield[1]</span>
<span class="c1"># ζfield[1] = -kfield[0]</span>
<span class="c1"># # normalize the ζfield</span>
<span class="c1"># ζfield /= np.sqrt(np.sum(np.abs(ζfield)**2, axis=0))</span>
<span class="c1"># # in the case of normal incidence, ζfield is undefined</span>
<span class="c1"># # so set it can be set to anything</span>
<span class="c1"># normalIncidence = (βfield == 0)</span>
<span class="c1"># ζfield[0][normalIncidence] = 1</span>
<span class="c1"># ζfield[1][normalIncidence] = 0</span>
<span class="c1"># ζfield[2][normalIncidence] = 0</span>

<span class="c1"># # decompose the field in P and S polarizations</span>
<span class="c1"># # first find P-pol and then use the complement to determine S-pol</span>
<span class="c1"># # the S-pol can be obtained by the dot product of E with ζ</span>
<span class="c1"># #EincS-Calc</span>
<span class="c1"># ESdot = Efield[0,:,:] * ζfield[0] + Efield[1,:,:] * ζfield[1]</span>
<span class="c1"># EincS = np.zeros(ζfield.shape)</span>
<span class="c1"># EincS[0] = ESdot[0] * ζfield[0]</span>
<span class="c1"># EincS[1] = ESdot[1] * ζfield[1]</span>
<span class="c1"># #EincP-Calc</span>
<span class="c1"># EincP = Efield - EincS</span>
<span class="c1"># del ESdot</span>

<span class="c1"># #ErefS-Calc</span>
<span class="c1"># ErefS = np.zeros(Efield.shape)</span>
<span class="c1"># ErefS[0] = fresnelS * EincS[0]</span>
<span class="c1"># ErefS[1] = fresnelS * EincS[1]</span>
<span class="c1"># ErefS[2] = fresnelS * EincS[2]</span>

<span class="c1"># #ErefP-Calc</span>
<span class="c1"># ErefP = np.zeros(Efield.shape)</span>
<span class="c1"># ErefP[0] = fresnelP * EincP[0]</span>
<span class="c1"># ErefP[1] = fresnelP * EincP[1]</span>
<span class="c1"># ErefP[2] = fresnelP * EincP[2]</span>

<span class="c1"># #Eref-Calc</span>
<span class="c1"># Eref  = ErefS + ErefP</span>

<span class="c1"># #kref-Calc</span>
<span class="c1"># ξfield    = np.zeros(ζfield.shape)</span>
<span class="c1"># ξfield[0] = -ζfield[1]</span>
<span class="c1"># ξfield[1] = ζfield[0]</span>
<span class="c1"># kref      = np.zeros(kfield.shape)</span>
<span class="c1"># kref[0]   = np.sin(θfield) * ξfield[0]</span>
<span class="c1"># kref[1]   = np.sin(θfield) * ξfield[1]</span>
<span class="c1"># kref[2]   = np.cos(θfield)</span>

<span class="c1"># #Href-Calc</span>
<span class="c1"># Href = nFree * np.cross(kref, Eref, axis=0)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
kfield has 0 NaNs
βfield has 0 NaNs
θfield has 0 NaNs
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[345]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Eref</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[345]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[[1.2, 1.2, 1.2, ..., 1.2, 1.2, 1.2],
        [1.2, 1.2, 1.2, ..., 1.2, 1.2, 1.2],
        [1.2, 1.2, 1.2, ..., 1.2, 1.2, 1.2],
        ...,
        [1.2, 1.2, 1.2, ..., 1.2, 1.2, 1.2],
        [1.2, 1.2, 1.2, ..., 1.2, 1.2, 1.2],
        [1.2, 1.2, 1.2, ..., 1.2, 1.2, 1.2]],

       [[0. , 0. , 0. , ..., 0. , 0. , 0. ],
        [0. , 0. , 0. , ..., 0. , 0. , 0. ],
        [0. , 0. , 0. , ..., 0. , 0. , 0. ],
        ...,
        [0. , 0. , 0. , ..., 0. , 0. , 0. ],
        [0. , 0. , 0. , ..., 0. , 0. , 0. ],
        [0. , 0. , 0. , ..., 0. , 0. , 0. ]],

       [[0. , 0. , 0. , ..., 0. , 0. , 0. ],
        [0. , 0. , 0. , ..., 0. , 0. , 0. ],
        [0. , 0. , 0. , ..., 0. , 0. , 0. ],
        ...,
        [0. , 0. , 0. , ..., 0. , 0. , 0. ],
        [0. , 0. , 0. , ..., 0. , 0. , 0. ],
        [0. , 0. , 0. , ..., 0. , 0. , 0. ]]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[333]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ζfield = np.zeros(kfield.shape)</span>
<span class="c1"># ζfield[0] = kfield[1]</span>
<span class="c1"># ζfield[1] = -kfield[0]</span>
<span class="c1"># np.sqrt(np.sum(np.abs(ζfield)**2, axis=0))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[333]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       ...,
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[329]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ζfield</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[329]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
750000
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[283]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">athing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">kref</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">bthing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">kref</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">cthing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">athing</span><span class="p">,</span> <span class="n">bthing</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">cthing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">athing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">bthing</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">athing</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">bthing</span><span class="p">[</span><span class="mi">1</span><span class="p">]))),</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">cthing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="n">athing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">bthing</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">athing</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">bthing</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">cthing</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">athing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">bthing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">athing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">bthing</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[283]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0, 0, 0)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[274]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">Href</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="n">kref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Eref</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">kref</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">Eref</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[274]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
473
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[276]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">kref</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[276]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1418
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[258]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># indexpick = 80</span>
<span class="c1"># akinc = np.array([kfield[0,indexpick,indexpick], kfield[1,indexpick,indexpick], kfield[2,indexpick,indexpick]])</span>
<span class="c1"># aζinc = np.array([ζfield[0,indexpick,indexpick], ζfield[1,indexpick,indexpick], ζfield[2,indexpick,indexpick]])</span>
<span class="c1"># dot1 = np.dot(akinc, aζinc)</span>
<span class="c1"># akref = np.array([kref[0,indexpick,indexpick], kref[1,indexpick,indexpick], kref[2,indexpick,indexpick]])</span>
<span class="c1"># dot2 = np.dot(akref, aζinc)</span>
<span class="c1"># aθ = θfield[indexpick,indexpick]</span>
<span class="c1"># aβ = βfield[indexpick,indexpick]</span>
<span class="c1"># dot3 = np.dot(akinc, akref)</span>
<span class="c1"># (dot1, dot2, dot3 - np.cos(aθ-aβ))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[208]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># using these I can also compute the local field of tranmission</span>
<span class="n">transmissionS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">fresnelS</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">nFree</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">nCore</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">transmissionP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">fresnelP</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">nFree</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">nCore</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">iplot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">transmissionP</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">ember</span><span class="p">,</span>
                <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
<span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">iplot</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span><span class="c1">#, format=ticker.FuncFormatter(fmt))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_78_0.png" class="no-scaled-link" src="_images/wavesight-old_78_0.png" style="width: 908px; height: 814px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">transmissionS</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_80_0.png" class="no-scaled-link" src="_images/wavesight-old_80_0.png" style="width: 722px; height: 316px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;# Local-k approximation to refraction</span>

<span class="s1">Given a mode in the waveguide whose propagation is suddenly truncated by the end of the waveguide, find the fields right outside the fiber by using the direction of the Poynting vector as a local direction of propagation of the incident fields.</span>

<span class="s1">```</span>

<span class="s1">┌────────────────────────────────────────────────────────────────────────┐</span>
<span class="s1">│ ...................................................................... │</span>
<span class="s1">│ ...................................................................... │</span>
<span class="s1">│ ...............................┌──────┐............................... │</span>
<span class="s1">│ ...............................│E&#39;, H&#39;│............................... │</span>
<span class="s1">│ ...............................└──────┘....................      ..... │</span>
<span class="s1">│ ...........................................................  nr  ..... │</span>
<span class="s1">│ ...........................................................      ..... │</span>
<span class="s1">│ XXXXXXXXXXXXXXXXXXXXXXXXXXXX--------------XXXXXXXXXXXXXXXXXXXXXXXXXXXX │</span>
<span class="s1">│ XXXXXXXXXXXXXXXXXXXXXXXXXXXX--------------XXXXXXXXXXXXXXXX        XXXX │</span>
<span class="s1">│ XXXXXXXXXXXXXXXXXXXXXXXXXXXX----┌────┐----XXXXXXXXXXXXXXXX n(x,y) XXXX │</span>
<span class="s1">│ XXXXXXXXXXXXXXXXXXXXXXXXXXXX----│E, H│----XXXXXXXXXXXXXXXX        XXXX │</span>
<span class="s1">│ XXXXXXXXXXXXXXXXXXXXXXXXXXXX----└────┘----XXXXXXXXXXXXXXXXXXXXXXXXXXXX │</span>
<span class="s1">│ XXXXXXXXXXXXXXXXXXXXXXXXXXXX--------------XXXXXXXXXXXXXXXXXXXXXXXXXXXX │</span>
<span class="s1">│ XXXXXXXXXXXXXXXXXXXXXXXXXXXX--------------XXXXXXXXXXXXXXXXXXXXXXXXXXXX │</span>
<span class="s1">│ XXXXXXXXXXXXXXXXXXXXXXXXXXXX--------------XXXXXXXXXXXXXXXXXXXXXXXXXXXX │</span>
<span class="s1">│                                                                        │</span>
<span class="s1">│                                   │                                    │</span>
<span class="s1">│                                                                        │</span>
<span class="s1">│                                   │                                    │</span>
<span class="s1">│                                                                        │</span>
<span class="s1">│                                   ├┐                      ┌────        │</span>
<span class="s1">│                                    └─┐  θ            ┌────┘            │</span>
<span class="s1">│                                   │  └─┐        ┌────┘                 │</span>
<span class="s1">│                                        └─┐ ┌────┘                      │</span>
<span class="s1">│                                   │  ┌───┴─┘                  nr       │</span>
<span class="s1">│       ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┬────┘─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─      │</span>
<span class="s1">│                               ┌─┘ │                        n(x,y)      │</span>
<span class="s1">│                             ┌─┘                                        │</span>
<span class="s1">│                           ┌┬┘     │                                    │</span>
<span class="s1">│                         ┌─┘└─┐                                         │</span>
<span class="s1">│                       ┌─┘    └─┐  │                                    │</span>
<span class="s1">│                     ┌─┘     β  └─┐                                     │</span>
<span class="s1">│                   ┌─┘            └┤                                    │</span>
<span class="s1">│                 ┌─┘                                                    │</span>
<span class="s1">│                ─┘                 │                                    │</span>
<span class="s1">│                                                                        │</span>
<span class="s1">└────────────────────────────────────────────────────────────────────────┘</span>

<span class="s1">```</span>


<span class="s1">```mermaid</span>
<span class="s1">flowchart TB</span>

<span class="s1">Start[&quot;Given:</span>
<span class="s1">k_z : propagation constant of mode</span>
<span class="s1">Δλ  : sampling resolution of arrays</span>
<span class="s1">a   : the radius of the waveguide core</span>
<span class="s1">b   : side of computational square</span>
<span class="s1">nCore : ref index of core</span>
<span class="s1">nCladding : ref index of cladding</span>
<span class="s1">nFree : ref index of launching space&quot;]</span>

<span class="s1">Start --&gt; indexArray[&quot;[#nxy-Calc]</span>
<span class="s1">Calculate n(x,y) on a plane</span>
<span class="s1">transverse to the waveguide.&quot;]</span>

<span class="s1">Start --&gt; AeAhBeBh[&quot;[#AB-Calc]</span>
<span class="s1">Calculate the coefficients</span>
<span class="s1">Ae, Ah, Be, Bh over the core and cladding</span>
<span class="s1">regions for the related mode.&quot;]</span>

<span class="s1">AeAhBeBh --&gt; Field[&quot;[#EH-Calc]</span>
<span class="s1">Calculate the numerical</span>
<span class="s1">values of the mode over</span>
<span class="s1">a grid with resolution Δλ.</span>
<span class="s1">E(x,y) = (E_z, &lt;b&gt;E&lt;b/&gt;_T)</span>
<span class="s1">H(x,y) = (H_z, &lt;b&gt;H&lt;b/&gt;_T)&quot;]</span>

<span class="s1">Field --&gt;  Poynting[&quot;[#EXH-Calc]</span>
<span class="s1">Poynting Vector Field</span>
<span class="s1">&lt;b&gt;P&lt;/b&gt;(x,y) = ½ Re(&lt;b&gt;E&lt;/b&gt; x &lt;b&gt;H&lt;/b&gt;*)&quot;]</span>

<span class="s1">Poynting --&gt; localk[&quot;[#normIncidentk-Calc]</span>
<span class="s1">Normalized incident k &lt;br&gt;k̂ := &lt;b&gt;k&lt;/b&gt;/|k| ≈ &lt;b&gt;P&lt;/b&gt;/|P|&quot;]</span>

<span class="s1">localk --&gt; Incident[&quot;[#β-Calc]</span>
<span class="s1">Angle of incidence across interface</span>
<span class="s1">β(x,y)&quot;]</span>

<span class="s1">Incident &amp; indexArray --&gt;  Refracted[&quot;[#θ-Calc]</span>
<span class="s1">Angles of refraction across interface</span>
<span class="s1">θ(x,y)&quot;]</span>

<span class="s1">Incident &amp; Field --&gt; FresnelS[&quot;[#FresnelS-Calc]</span>
<span class="s1">Fresnel-S Coefficient</span>
<span class="s1">FS(x,y) = E_S&#39;/E_S (S-pol)&quot;]</span>

<span class="s1">Incident &amp; Field --&gt; FresnelP[&quot;[#FresnelP-Calc]</span>
<span class="s1">    Fresnel-P Coefficient&lt;br&gt;FP(x,y) = E_P&#39;/E_P (P-pol)&quot;]</span>

<span class="s1">localk --&gt; Sdir[&quot;[#ζ-Calc]</span>
<span class="s1">    S-Normal vector field</span>
<span class="s1">    (Direction normal to plane of incidence)</span>
<span class="s1">    &lt;b&gt;ζ(x,y)&lt;b/&gt; = ẑ x k̂</span>
<span class="s1">    ζ̂(x,y) = &lt;b&gt;ζ&lt;b/&gt; / |ζ|&quot;]</span>

<span class="s1">Sdir --&gt; Spol[&quot;[#EincS-Calc]</span>
<span class="s1">S-component of E</span>
<span class="s1">E_S = &lt;b&gt;E&lt;/b&gt; · ζ̂&quot;]</span>

<span class="s1">Spol --&gt; Ppol[&quot;[#EincP-Calc]</span>
<span class="s1">P-component of E</span>
<span class="s1">E_P = E - E_S&quot;]</span>

<span class="s1">Ppol &amp; FresnelP --&gt; EPref[&quot;[#ErefP-Calc]</span>
<span class="s1">Refracted E (P-pol)</span>
<span class="s1">E_P&#39; = E_P  FP(x,y)&quot;]</span>

<span class="s1">Spol &amp; FresnelS --&gt; ESref[&quot;[#ErefS-Calc]</span>
<span class="s1">Refracted E (S-pol)</span>
<span class="s1">E_S&#39; = E_S  FS(x,y)&quot;]</span>

<span class="s1">EPref &amp; ESref --&gt; Eref[&quot;[#Eref-Calc]</span>
<span class="s1">The refracted electric field</span>
<span class="s1">E&#39; = E_S + E_P&quot;]</span>

<span class="s1">indexArray &amp; localk --&gt; localkrefnorm[&quot;[#kref-Calc]</span>
<span class="s1">Normalized refracted k̂&#39;</span>
<span class="s1">&lt;b&gt;k̂&#39;&lt;/b&gt;&quot;]</span>

<span class="s1">localkrefnorm &amp; Eref --&gt; Href[&quot;[#Href-Calc]</span>
<span class="s1">The refracted H-field&lt;br&gt;H&#39; ≈ √(μ&#39;ϵ&#39;)/µ&#39; k̂&#39; x E&#39;&quot;]</span>

<span class="s1">style Start fill:blue</span>
<span class="s1">style Href fill:red</span>
<span class="s1">style Eref fill:red</span>
<span class="s1">```</span>
<span class="s1">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import re</span>

<span class="c1"># def extract_substrings_inside_square_brackets(text):</span>
<span class="c1">#     pattern = r&#39;\[#([^]]+)\]&#39;</span>
<span class="c1">#     substrings = re.findall(pattern, text)</span>
<span class="c1">#     return substrings</span>

<span class="c1"># hashes = extract_substrings_inside_square_brackets(string)</span>
<span class="c1"># for idx, hash in enumerate(hashes):</span>
<span class="c1">#     print(f&#39;{hash}&#39;)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">nxy-Calc</span>
<span class="sd">AB-Calc</span>
<span class="sd">EH-Calc</span>
<span class="sd">EXH-Calc</span>
<span class="sd">normIncidentk-Calc</span>
<span class="sd">β-Calc</span>
<span class="sd">θ-Calc</span>
<span class="sd">FresnelS-Calc</span>
<span class="sd">FresnelP-Calc</span>
<span class="sd">ζ-Calc</span>
<span class="sd">EincS-Calc</span>
<span class="sd">EincP-Calc</span>
<span class="sd">ErefP-Calc</span>
<span class="sd">ErefS-Calc</span>
<span class="sd">Eref-Calc</span>
<span class="sd">kref-Calc</span>
<span class="sd">Href-Calc</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<section id="id1">
<h4>####Spaguetti code<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># given a field (Ex, Ey, Ez) at a plane calculate the discrete</span>
<span class="c1"># fourier transform of the field in the x,y,z directions</span>
<span class="c1"># this would provide the field in the frequency domain</span>
<span class="c1"># the field is assumed to be periodic in the x,y,z directions</span>
<span class="n">fiberfield_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">eigenbasis</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:,:])</span>
<span class="c1"># at the moment I haven&#39;t calculate the z component of the field</span>
<span class="c1"># let me just assume a z component that is roughly of the same magnitude</span>
<span class="c1"># of the x and y components, that starts normal at the center and</span>
<span class="c1"># deviates to the NA of the fiber at the edge of it</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ex</span> <span class="o">=</span> <span class="n">fiberfield_t</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span>
<span class="n">Ey</span> <span class="o">=</span> <span class="n">fiberfield_t</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:]</span>
<span class="n">NA</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;NA&#39;</span><span class="p">]</span>
<span class="n">nCore</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;nCore&#39;</span><span class="p">]</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">fiber_sol</span><span class="p">[</span><span class="s1">&#39;coreRadius&#39;</span><span class="p">]</span>
<span class="n">thetamax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">NA</span><span class="o">/</span><span class="n">nCore</span><span class="p">)</span>
<span class="c1"># calculate the magnitude of the transverse field</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Xg</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Yg</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># calculate the angle of E at each point</span>
<span class="n">launchAngle</span> <span class="o">=</span> <span class="n">thetamax</span><span class="o">/</span><span class="n">a</span> <span class="o">*</span> <span class="n">r</span>
<span class="c1"># knowing the angle at each position I should be able to &quot;calculate&quot;</span>
<span class="c1"># the z component of the field</span>
<span class="c1"># this doesn&#39;t make any sense, the direction of the</span>
<span class="c1"># electric field is not the direction of the wave vector</span>
<span class="c1"># ok, instead let me estimate the direction of the wave vector</span>
<span class="c1"># across the fiber and then use that together with the field at</span>
<span class="c1"># each position to determine what is a compatible value for the z component</span>
<span class="n">kmag</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">λfree</span><span class="o">*</span><span class="n">nCore</span>
<span class="n">dirfield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Yg</span><span class="p">,</span> <span class="n">Xg</span><span class="p">)</span>
<span class="n">xhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dirfield</span><span class="p">)</span>
<span class="n">yhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dirfield</span><span class="p">)</span>
<span class="n">kz</span> <span class="o">=</span> <span class="n">kmag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span>
<span class="n">kx</span> <span class="o">=</span> <span class="n">kmag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span> <span class="o">*</span> <span class="n">xhat</span>
<span class="n">ky</span> <span class="o">=</span> <span class="n">kmag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span> <span class="o">*</span> <span class="n">yhat</span>
<span class="c1"># at every point</span>
<span class="c1"># now let me make</span>
<span class="c1"># use this to calculate a possible z component for E</span>
<span class="n">dotEk</span> <span class="o">=</span> <span class="n">fiberfield_t</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span> <span class="o">*</span> <span class="n">kx</span> <span class="o">+</span> <span class="n">fiberfield_t</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="o">*</span> <span class="n">ky</span>
<span class="n">Ez</span> <span class="o">=</span> <span class="o">-</span><span class="n">dotEk</span><span class="o">/</span><span class="n">kz</span>
<span class="c1"># in this construction the electric field is always in parallel to the plane of incidence</span>
<span class="n">fresnel</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">nCore</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span>
           <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span> <span class="o">+</span> <span class="n">nCore</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">nCore</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">launchAngle</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">Erefracted_x</span> <span class="o">=</span> <span class="n">fresnel</span> <span class="o">*</span> <span class="n">Ex</span>
<span class="n">Erefracted_y</span> <span class="o">=</span> <span class="n">fresnel</span> <span class="o">*</span> <span class="n">Ey</span>
<span class="n">Erefracted_z</span> <span class="o">=</span> <span class="n">fresnel</span> <span class="o">*</span> <span class="n">Ez</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Erefracted_x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_87_0.png" class="no-scaled-link" src="_images/wavesight-old_87_0.png" style="width: 427px; height: 418px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ok, next part</span>
<span class="c1"># i need to find the farfield for the refracted field</span>
<span class="c1"># i think I have</span>
<span class="n">apertureRadius</span> <span class="o">=</span> <span class="n">b</span>
<span class="n">λ</span> <span class="o">=</span> <span class="n">λfree</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">λ</span>
<span class="n">replicas</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dist_to_ML</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="n">dist_to_ML</span> <span class="o">*</span> <span class="mi">5</span>
<span class="n">farfield_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">zmax</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">apertureRadius</span> <span class="c1"># spatial extent of the field</span>
<span class="n">field</span> <span class="o">=</span> <span class="n">Erefracted_x</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">idx_width</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">if</span> <span class="n">replicas</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">nearfourier</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">field</span><span class="p">,(</span><span class="n">idx_width</span><span class="p">,</span> <span class="n">idx_width</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">field</span>
<span class="n">kx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="o">=</span><span class="n">dx</span><span class="p">))</span>
<span class="n">ky</span> <span class="o">=</span> <span class="n">kx</span>
<span class="n">kx</span><span class="p">,</span> <span class="n">ky</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">)</span>
<span class="n">kz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">kx</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">ky</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span><span class="p">)</span>

<span class="n">gator</span> <span class="o">=</span> <span class="mf">1.</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">farfield_axis</span><span class="p">,</span> <span class="n">kz</span><span class="p">)</span>
<span class="n">gator</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">*</span><span class="n">farfield_axis</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">*</span><span class="n">kz</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">gator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">gator</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">NA</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">180</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
12.709032994395436
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gator</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(100, 362, 362)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cmasher</span> <span class="k">as</span> <span class="nn">cmr</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">farfields</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ex&#39;</span><span class="p">:</span><span class="n">Erefracted_x</span><span class="p">,</span> <span class="s1">&#39;ey&#39;</span><span class="p">:</span><span class="n">Erefracted_y</span><span class="p">}</span>
<span class="k">for</span> <span class="n">field_component</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span><span class="s1">&#39;ey&#39;</span><span class="p">]:</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">field_component</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">idx_width</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">field</span>
    <span class="c1"># calculate the Fourier transform of the nearfield</span>
    <span class="n">nearfourier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
    <span class="c1"># multiply by the farfield propagator</span>
    <span class="n">farfourier</span> <span class="o">=</span> <span class="n">nearfourier</span> <span class="o">*</span> <span class="n">gator</span>
    <span class="c1"># calculate the inverse Fourier transform</span>
    <span class="n">farfield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft2</span><span class="p">(</span><span class="n">farfourier</span><span class="p">)</span>

    <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">replicas</span><span class="p">,</span> <span class="n">L</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">replicas</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zmax</span><span class="p">]</span>
    <span class="c1"># get the field on the zx plane</span>
    <span class="n">pfield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">farfield</span><span class="p">[::,</span><span class="n">farfield</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">farfields</span><span class="p">[</span><span class="n">field_component</span><span class="p">]</span> <span class="o">=</span> <span class="n">pfield</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pfield</span><span class="p">,</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmr</span><span class="o">.</span><span class="n">ember</span><span class="p">,</span>
            <span class="n">extent</span> <span class="o">=</span> <span class="n">extent</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x/$\mu$m&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;z/$\mu$m&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;|</span><span class="si">%s</span><span class="s1">|^2&#39;</span> <span class="o">%</span> <span class="n">field_component</span><span class="p">)</span>
<span class="c1">#     plt.colorbar()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_92_0.png" class="no-scaled-link" src="_images/wavesight-old_92_0.png" style="width: 619px; height: 809px;" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_92_1.png" class="no-scaled-link" src="_images/wavesight-old_92_1.png" style="width: 619px; height: 809px;" />
</div>
</div>
</section>
</section>
</section>
<section id="##Gray-Notation-(deprecated)">
<h2>##Gray Notation (deprecated)<a class="headerlink" href="###Gray-Notation-(deprecated)" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nCore</span> <span class="o">=</span> <span class="mf">1.45</span>
<span class="n">nCladding</span> <span class="o">=</span> <span class="mf">1.387</span>
<span class="n">coreRadius</span> <span class="o">=</span> <span class="mf">3.</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">tmfun</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">tmfungen</span><span class="p">(</span><span class="n">λfree</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span>
                 <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">n0</span><span class="o">=</span><span class="n">nCladding</span><span class="p">,</span>
                 <span class="n">n1</span><span class="o">=</span><span class="n">nCore</span><span class="p">,</span>
                 <span class="n">a</span><span class="o">=</span><span class="n">coreRadius</span><span class="p">)</span>
<span class="n">γmax</span> <span class="o">=</span> <span class="mf">1.001</span><span class="o">*</span><span class="n">nCore</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">wavelength</span>
<span class="n">γmin</span> <span class="o">=</span> <span class="mf">0.999</span><span class="o">*</span><span class="n">nCladding</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">wavelength</span>
<span class="n">γrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">γmin</span><span class="p">,</span> <span class="n">γmax</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">tmvals</span> <span class="o">=</span> <span class="n">tmfun</span><span class="p">(</span><span class="n">γrange</span><span class="p">)</span>
<span class="n">tmzeros</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">findallroots</span><span class="p">(</span><span class="n">tmfun</span><span class="p">,</span> <span class="n">γmin</span><span class="p">,</span> <span class="n">γmax</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bisect&#39;</span><span class="p">,</span> <span class="n">num_decimals</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tmzerocheck</span> <span class="o">=</span> <span class="n">tmfun</span><span class="p">(</span><span class="n">tmzeros</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">γrange</span><span class="p">,</span> <span class="n">tmvals</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tmzeros</span><span class="p">,</span><span class="n">tmzerocheck</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">γmin</span><span class="p">,</span> <span class="n">γmax</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;w:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/juan/ZiaLab/Codebase/wavesight/wavesight.py:19: RuntimeWarning: invalid value encountered in sqrt
  return  (n1**2*(special.jv(-1 + n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2)) - special.jv(1 + n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2))))/(2.*a*n0**2*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2)*special.jv(n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2))) + (-special.kn(-1 + n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)) - special.kn(1 + n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)))/(2.*a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)*special.kn(n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_94_1.png" src="_images/wavesight-old_94_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nCore</span> <span class="o">=</span> <span class="mf">1.45</span>
<span class="n">nCladding</span> <span class="o">=</span> <span class="mf">1.387</span>
<span class="n">coreRadius</span> <span class="o">=</span> <span class="mf">3.</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">tefun</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">tefungen</span><span class="p">(</span><span class="n">λfree</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span>
                 <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">n0</span><span class="o">=</span><span class="n">nCladding</span><span class="p">,</span>
                 <span class="n">n1</span><span class="o">=</span><span class="n">nCore</span><span class="p">,</span>
                 <span class="n">a</span><span class="o">=</span><span class="n">coreRadius</span><span class="p">)</span>
<span class="n">γmax</span> <span class="o">=</span> <span class="mf">1.001</span><span class="o">*</span><span class="n">nCore</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">wavelength</span>
<span class="n">γmin</span> <span class="o">=</span> <span class="mf">0.999</span><span class="o">*</span><span class="n">nCladding</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">wavelength</span>
<span class="n">γrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">γmin</span><span class="p">,</span> <span class="n">γmax</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">tevals</span> <span class="o">=</span> <span class="n">tefun</span><span class="p">(</span><span class="n">γrange</span><span class="p">)</span>
<span class="n">tezeros</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">findallroots</span><span class="p">(</span><span class="n">tefun</span><span class="p">,</span> <span class="n">γmin</span><span class="p">,</span> <span class="n">γmax</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bisect&#39;</span><span class="p">,</span> <span class="n">num_decimals</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">tezerocheck</span> <span class="o">=</span> <span class="n">tefun</span><span class="p">(</span><span class="n">tezeros</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">γrange</span><span class="p">,</span> <span class="n">tevals</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tezeros</span><span class="p">,</span><span class="n">tezerocheck</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">γmin</span><span class="p">,</span> <span class="n">γmax</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;w:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/juan/ZiaLab/Codebase/wavesight/wavesight.py:25: RuntimeWarning: invalid value encountered in sqrt
  return (special.jv(-1 + n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2)) - special.jv(1 + n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2)))/(2.*a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2)*special.jv(n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2))) + (-special.kn(-1 + n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)) - special.kn(1 + n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)))/(2.*a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)*special.kn(n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_95_1.png" src="_images/wavesight-old_95_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nCore</span> <span class="o">=</span> <span class="mf">1.45</span>
<span class="n">nCladding</span> <span class="o">=</span> <span class="mf">1.387</span>
<span class="n">coreRadius</span> <span class="o">=</span> <span class="mf">3.</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">n</span><span class="o">=</span><span class="mi">3</span>
<span class="n">hefun</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">hefungen</span><span class="p">(</span><span class="n">λfree</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span>
                 <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                 <span class="n">n0</span><span class="o">=</span><span class="n">nCladding</span><span class="p">,</span>
                 <span class="n">n1</span><span class="o">=</span><span class="n">nCore</span><span class="p">,</span>
                 <span class="n">a</span><span class="o">=</span><span class="n">coreRadius</span><span class="p">)</span>
<span class="n">γmax</span> <span class="o">=</span> <span class="mf">1.001</span><span class="o">*</span><span class="n">nCore</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">wavelength</span>
<span class="n">γmin</span> <span class="o">=</span> <span class="mf">0.999</span><span class="o">*</span><span class="n">nCladding</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">wavelength</span>
<span class="c1"># γrange = np.linspace(γmin, γmax, 1000)</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">γrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">γmin</span><span class="p">,</span> <span class="n">γmax</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">γmax</span><span class="o">-</span><span class="n">γmin</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)))</span>
<span class="n">hevals</span> <span class="o">=</span> <span class="n">hefun</span><span class="p">(</span><span class="n">γrange</span><span class="p">)</span>
<span class="n">zc</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">zerocrossings</span><span class="p">(</span><span class="n">hevals</span><span class="p">)</span>
<span class="n">zcvals</span> <span class="o">=</span> <span class="n">hevals</span><span class="p">[</span><span class="n">zc</span><span class="p">]</span>
<span class="n">good_crossings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">zcvals</span><span class="p">))</span>
<span class="n">zcvals</span> <span class="o">=</span> <span class="n">zcvals</span><span class="p">[</span><span class="n">good_crossings</span><span class="p">]</span>
<span class="n">zc</span> <span class="o">=</span> <span class="n">zc</span><span class="p">[</span><span class="n">good_crossings</span><span class="p">]</span>
<span class="n">hezeros</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">findallroots</span><span class="p">(</span><span class="n">hefun</span><span class="p">,</span> <span class="n">γmin</span><span class="p">,</span> <span class="n">γmax</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bisect&#39;</span><span class="p">,</span> <span class="n">num_decimals</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hezerocheck</span> <span class="o">=</span> <span class="n">hefun</span><span class="p">(</span><span class="n">hezeros</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">γrange</span><span class="p">,</span> <span class="n">hevals</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">hezeros</span><span class="p">,</span><span class="n">hezerocheck</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">γmin</span><span class="p">,</span> <span class="n">γmax</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;w:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/juan/ZiaLab/Codebase/wavesight/wavesight.py:30: RuntimeWarning: invalid value encountered in sqrt
  return  -((n**2*(1/(γ**2 - (4*n0**2*np.pi**2)/λfree**2) + 1/(-γ**2 + (4*n1**2*np.pi**2)/λfree**2))*(1/(a**2*(γ**2 - (4*n0**2*np.pi**2)/λfree**2)) + n1**2/(a**2*n0**2*(-γ**2 + (4*n1**2*np.pi**2)/λfree**2))))/a**2) + ((special.jv(-1 + n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2)) - special.jv(1 + n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2)))/(2.*a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2)*special.jv(n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2))) + (-special.kn(-1 + n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)) - special.kn(1 + n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)))/(2.*a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)*special.kn(n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2))))*((n1**2*(special.jv(-1 + n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2)) - special.jv(1 + n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2))))/(2.*a*n0**2*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2)*special.jv(n,a*np.sqrt(-γ**2 + (4*n1**2*np.pi**2)/λfree**2))) + (-special.kn(-1 + n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)) - special.kn(1 + n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)))/(2.*a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2)*special.kn(n,a*np.sqrt(γ**2 - (4*n0**2*np.pi**2)/λfree**2))))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/wavesight-old_96_1.png" src="_images/wavesight-old_96_1.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>